# IMCAT UI 모듈 사용 가이드

> **모듈 로딩**: `IMCAT.use('모듈명')` 으로 동적 로드  
> **메모리 관리**: `IMCAT.view.registerInstance(instance)` 로 SPA 페이지 전환 시 자동 정리

---

## 목차

- [코어 API](#코어-api)
  - [DOM](#dom---dom-조작)
  - [EventBus](#eventbus---이벤트-버스)
  - [Router](#router---spa-라우팅)
  - [State](#state---상태-관리)
  - [Storage](#storage---로컬-저장소)
  - [Template](#template---템플릿-엔진)
  - [Security](#security---보안-유틸리티)
  - [Utils](#utils---유틸리티-함수)
  - [Loading](#loading---로딩-인디케이터)
  - [API](#api---http-클라이언트)
- [외장 모듈](#모듈-목록)

---

## 코어 API

코어 API는 `IMCAT` 전역 객체를 통해 직접 접근합니다.

### DOM - DOM 조작

```javascript
// 요소 선택
const el = IMCAT('#app');
const items = IMCAT('.item');

// 체이닝
IMCAT('#app')
  .addClass('active')
  .removeClass('hidden')
  .text('Hello World')
  .on('click', handler);

// 여러 요소 순회
IMCAT('.nav-link').each(link => {
  link.classList.add('active');
});

// 존재 확인
if (IMCAT('#element').length > 0) {
  // 요소 존재
}
```

**주요 메서드:**

| 메서드 | 설명 |
|--------|------|
| `.addClass(name)` | 클래스 추가 |
| `.removeClass(name)` | 클래스 제거 |
| `.toggleClass(name)` | 클래스 토글 |
| `.hasClass(name)` | 클래스 존재 여부 |
| `.text([value])` | 텍스트 조회/설정 |
| `.html([value])` | HTML 조회/설정 |
| `.val([value])` | 값 조회/설정 |
| `.attr(name, [value])` | 속성 조회/설정 |
| `.data(key, [value])` | data-* 속성 |
| `.on(event, handler)` | 이벤트 리스너 추가 |
| `.off(event, handler)` | 이벤트 리스너 제거 |
| `.show()` / `.hide()` | 표시/숨김 |
| `.append(content)` | 자식 추가 |
| `.remove()` | 요소 제거 |
| `.find(selector)` | 하위 요소 찾기 |
| `.closest(selector)` | 상위 요소 찾기 |
| `.parent()` | 부모 요소 |
| `.children()` | 자식 요소 |
| `.each(callback)` | 각 요소 순회 |

---

### EventBus - 이벤트 버스

```javascript
// 이벤트 구독
IMCAT.on('user:login', (user) => {
  console.log('로그인:', user);
});

// 일회성 구독
IMCAT.once('data:loaded', (data) => {
  console.log('데이터 로드 완료');
});

// 이벤트 발행
IMCAT.emit('user:login', { name: '홍길동' });

// 구독 취소
IMCAT.off('user:login', handler);
```

---

### Router - SPA 라우팅

```javascript
// 페이지 네비게이션
IMCAT.view.navigate('views/home.html');

// URL 파라미터 가져오기
const params = IMCAT.view.params();  // { id: '123', page: '1' }

// 훅 등록
IMCAT.view.beforeLoad((path) => {
  console.log('로드 시작:', path);
  return true;  // false 반환 시 로드 취소
});

IMCAT.view.afterLoad((path) => {
  console.log('로드 완료:', path);
});

IMCAT.view.onError((error, path) => {
  console.error('로드 실패:', error);
});

// 인스턴스 등록 (SPA 메모리 관리)
IMCAT.view.registerInstance(instance);

// 컨테이너 설정
IMCAT.view.setContainer('#app-content');
```

**HTML 속성 기반 라우팅:**

```html
<!-- catui-href: 클릭 시 자동 네비게이션 -->
<a href="#" catui-href="views/home.html">홈</a>
<a href="#" catui-href="views/about.html">소개</a>

<!-- catui-target: 렌더링 타겟 지정 -->
<body catui-target="app-content">
  <div id="app-content"></div>
</body>
```

---

### State - 상태 관리

```javascript
// 로컬 상태 생성
const state = IMCAT.state.create({
  count: 0,
  user: null
});

// 상태 변경 감지 (watch)
state.watch('count', (newVal, oldVal) => {
  console.log(`count: ${oldVal} -> ${newVal}`);
});

// 상태 변경 (자동 감지됨)
state.count++;
state.user = { name: '홍길동' };

// computed 값
state.compute('double', () => state.count * 2);

// 배치 업데이트
state.batch(() => {
  state.count = 10;
  state.user = { name: 'Kim' };
});

// 상태 조회/설정
state.getState();
state.setState({ count: 0 });

// 초기화
state.reset();

// 정리
state.destroy();
```

**전역 상태:**

```javascript
// 전역 상태 사용 (앱 전체 공유)
const store = IMCAT.globalState.use('storeName', { theme: 'light' });
store.theme = 'dark';  // 자동 감지

// 다른 곳에서 동일한 스토어 접근
const store2 = IMCAT.globalState.use('storeName');
console.log(store2.theme);  // 'dark'
```

---

### Storage - 로컬 저장소

```javascript
// 저장
IMCAT.storage.set('user', { name: '홍길동', id: 1 });

// TTL (만료 시간) 설정
IMCAT.storage.set('token', 'abc123', { expires: 3600 });  // 1시간

// sessionStorage 사용
IMCAT.storage.set('temp', 'data', { storage: 'session' });

// 가져오기
const user = IMCAT.storage.get('user');
const count = IMCAT.storage.get('count', 0);  // 기본값 지정

// 삭제
IMCAT.storage.remove('user');

// 존재 확인
IMCAT.storage.has('user');

// 전체 삭제
IMCAT.storage.clear();
```

---

### Template - 템플릿 엔진

```javascript
// 기본 렌더링 (자동 XSS 방어)
const html = IMCAT.template.render(
  'Hello {{name}}!',
  { name: 'World' }
);
// 'Hello World!'

// Raw 렌더링 (이스케이프 없음 - 신뢰된 데이터만!)
const html = IMCAT.template.renderRaw(
  '<div>{{content}}</div>',
  { content: '<b>Bold</b>' }
);

// 조건부 렌더링
const html = IMCAT.template.if(
  user.isAdmin,
  '<button>관리자</button>'
);

// 리스트 렌더링
const html = IMCAT.template.each(
  items,
  '<li>{{name}} - {{price}}원</li>'
);
```

---

### Security - 보안 유틸리티

```javascript
// HTML 이스케이프 (XSS 방어)
const safe = IMCAT.escape('<script>alert("XSS")</script>');
// '&lt;script&gt;alert("XSS")&lt;/script&gt;'

// HTML 새니타이징 (위험 태그 제거)
const clean = IMCAT.sanitize(userInput);

// 경로 검증
const isValid = IMCAT.security.validatePath('views/home.html');
// true

IMCAT.security.validatePath('../../../etc/passwd');
// false (경로 순회 차단)
```

---

### Utils - 유틸리티 함수

```javascript
// 타입 체크
IMCAT.isString(value);
IMCAT.isNumber(value);
IMCAT.isArray(value);
IMCAT.isObject(value);
IMCAT.isFunction(value);

// 랜덤 ID 생성
const id = IMCAT.randomId('prefix');  // 'prefix_a1b2c3d4'

// 디바운스
const debouncedFn = IMCAT.debounce(fn, 300);

// 스로틀
const throttledFn = IMCAT.throttle(fn, 100);

// 객체 병합 (깊은 복사)
const merged = IMCAT.extend({}, obj1, obj2);

// 깊은 복사
const copy = IMCAT.clone(obj);
```

---

### Loading - 로딩 인디케이터

```javascript
// 로딩 표시
IMCAT.loading.show('데이터 로딩 중...');

// 로딩 숨김
IMCAT.loading.hide();

// 표시 여부 확인
IMCAT.loading.isVisible();

// 콘텐츠 변경
IMCAT.loading.setContent('<div>커스텀 로딩</div>');
```

---

### API - HTTP 클라이언트

```javascript
// GET 요청
const data = await IMCAT.api.get('/api/users');

// POST 요청
const result = await IMCAT.api.post('/api/users', {
  name: '홍길동',
  email: 'hong@example.com'
});

// PUT 요청
await IMCAT.api.put('/api/users/1', { name: '김철수' });

// DELETE 요청
await IMCAT.api.delete('/api/users/1');

// 옵션
const data = await IMCAT.api.get('/api/data', {
  headers: { 'Authorization': 'Bearer token' },
  timeout: 5000
});

// 인터셉터
IMCAT.api.interceptors.request((config) => {
  config.headers['Authorization'] = `Bearer ${getToken()}`;
  return config;
});

IMCAT.api.interceptors.response(
  (response) => response,
  (error) => { handleError(error); throw error; }
);
```

---

### Animation - 애니메이션

```javascript
// 요소 애니메이션
IMCAT.animate('#element')
  .fadeIn(300)
  .then(() => console.log('완료'));

IMCAT.animate('#element').fadeOut(300);
IMCAT.animate('#element').slideDown(300);
IMCAT.animate('#element').slideUp(300);

// 커스텀 애니메이션
IMCAT.animate('#element').custom({
  from: { opacity: 0, transform: 'translateY(20px)' },
  to: { opacity: 1, transform: 'translateY(0)' },
  duration: 500,
  easing: 'easeOutCubic'
});
```

---

### URL - URL 유틸리티

```javascript
// 쿼리 스트링 파싱
const params = IMCAT.url.parse('?id=123&page=1');
// { id: '123', page: '1' }

// 객체를 쿼리 스트링으로
const query = IMCAT.url.stringify({ id: 123, page: 1 });
// 'id=123&page=1'

// 특정 파라미터 가져오기
const id = IMCAT.url.getParam('id');

// 파라미터 설정 (URL 변경)
IMCAT.url.setParam('page', '2');
```

---

### Form - 폼 검증

```javascript
// 폼 검증기 생성
const validator = IMCAT.form.create('#myForm', {
  rules: {
    email: { required: true, email: true },
    password: { required: true, minLength: 8 },
    age: { required: true, min: 18, max: 100 }
  },
  messages: {
    email: {
      required: '이메일을 입력하세요',
      email: '올바른 이메일 형식이 아닙니다'
    }
  },
  onValid: (data) => console.log('유효:', data),
  onInvalid: (errors) => console.log('오류:', errors)
});

// 수동 검증
const isValid = validator.validate();

// 특정 필드 검증
const fieldValid = validator.validateField('email');

// 오류 가져오기
const errors = validator.getErrors();

// 리셋
validator.reset();

// 정리
validator.destroy();
```

---

## 모듈 목록

| 모듈명 | 설명 | 포함 컴포넌트 |
|--------|------|---------------|
| `theme` | 테마 관리 | Theme |
| `overlays` | 오버레이 | Modal, Drawer, Offcanvas, Lightbox |
| `feedback` | 피드백 | Toast, Notification, ProgressTracker, Skeleton |
| `dropdown` | 드롭다운 | Dropdown |
| `forms` | 폼 확장 | FileUpload, Rating, SignaturePad, FormWizard |
| `tooltips` | 툴팁/팝오버 | Tooltip, Popover |
| `navigation` | 네비게이션 | Tabs, Accordion, Collapse, MegaMenu, TreeView |
| `pagination` | 페이지네이션 | Pagination, DataPaginator |
| `carousel` | 캐러셀 | Carousel, Lightbox |
| `stepper` | 단계 표시 | Stepper, VerticalStepper |
| `selectors` | 선택자 | Autocomplete, MultiSelect, RangeSlider |
| `pickers` | 피커 | DatePicker, TimePicker, ColorPicker |
| `scroll` | 스크롤 | VirtualScroll, Scrollspy, InfiniteScroll |
| `data-viz` | 데이터 시각화 | DataTable, Chart, Masonry, Kanban, Calendar |
| `advanced-ui` | 고급 UI | SplitPane, QRCode, CopyToClipboard |
| `text-editors` | 텍스트 에디터 | RichTextEditor, MarkdownEditor |
| `social` | 소셜 | ChatUI, Comments, Share, Reactions |
| `security-input` | 보안 입력 | OTPInput, PINInput |
| `media-viewer` | 미디어 뷰어 | VideoPlayer, AudioPlayer, ImageViewer |
| `live-status` | 실시간 상태 | OnlineStatus, TypingIndicator |

---

## 기본 사용 패턴

```javascript
// 1. 모듈 로드
const Module = await IMCAT.use('모듈명');

// 2. 인스턴스 생성
const instance = new Module.Component(selector, options);

// 3. SPA 메모리 관리 등록
IMCAT.view.registerInstance(instance);
```

---

## 1. Theme

```javascript
const Theme = await IMCAT.use('theme');

const theme = new Theme({
  defaultTheme: 'system',     // 'light' | 'dark' | 'system'
  storageKey: 'imcat-theme',
  transition: 'fade',         // 'none' | 'fade' | 'slide' | 'circle'
  transitionDuration: 300,
  onChange: (name, resolved) => console.log(name, resolved)
});

// 메서드
theme.set('dark');            // 테마 설정
theme.toggle();               // 라이트/다크 토글
theme.getResolved();          // 실제 적용된 테마
theme.destroy();
```

---

## 2. Overlays

```javascript
const Overlays = await IMCAT.use('overlays');

// Modal
const modal = new Overlays.Modal({
  title: '제목',
  content: '<p>내용</p>',
  size: 'md',                 // 'sm' | 'md' | 'lg' | 'xl'
  centered: true,
  buttons: [
    { text: '취소', variant: 'secondary', action: () => modal.hide() },
    { text: '확인', variant: 'primary', action: () => save() }
  ]
});
modal.show();

// 정적 메서드
await Overlays.Modal.confirm({ title: '확인', message: '삭제?' });
await Overlays.Modal.alert({ title: '알림', message: '완료!' });

// Drawer
const drawer = new Overlays.Drawer({
  position: 'right',          // 'left' | 'right' | 'top' | 'bottom'
  title: '필터',
  content: '<form>...</form>',
  width: '400px'
});
drawer.show();
```

---

## 3. Feedback

```javascript
const Feedback = await IMCAT.use('feedback');

// Toast (정적)
Feedback.Toast.success('저장되었습니다!');
Feedback.Toast.error('오류 발생');
Feedback.Toast.warning('주의');
Feedback.Toast.info('안내');

// Notification (정적)
Feedback.Notification.init('top-right');
Feedback.Notification.show({
  title: '알림',
  message: '새 메시지',
  type: 'info',
  duration: 5000
});

// ProgressTracker
const tracker = new Feedback.ProgressTracker('#progress', {
  steps: ['주문', '결제', '배송', '완료'],
  current: 0
});
tracker.next();               // 다음 단계
tracker.goTo(2);              // 특정 단계로

// Skeleton
const skeleton = new Feedback.Skeleton('#loading', {
  type: 'card',               // 'text' | 'avatar' | 'card' | 'image' | 'list'
  lines: 3
});
```

---

## 4. Dropdown

```javascript
const Dropdown = await IMCAT.use('dropdown');

const dropdown = new Dropdown('#menuBtn', {
  items: [
    { text: '프로필', icon: 'person', action: () => {} },
    { text: '설정', icon: 'settings' },
    { type: 'divider' },
    { text: '로그아웃', icon: 'logout', danger: true }
  ],
  position: 'bottom',         // 'top' | 'bottom' | 'left' | 'right'
  align: 'end',               // 'start' | 'center' | 'end'
  openOnHover: false,
  onSelect: (item) => console.log(item)
});
```

---

## 5. Forms

```javascript
const Forms = await IMCAT.use('forms');

// FileUpload
const upload = new Forms.FileUpload('#file', {
  accept: 'image/*',
  multiple: true,
  maxSize: 5 * 1024 * 1024,
  onChange: (files) => console.log(files)
});

// Rating
const rating = new Forms.Rating('#rating', {
  max: 5,
  value: 0,
  onChange: (val) => console.log(val)
});

// SignaturePad
const pad = new Forms.SignaturePad('#signature', {
  width: 400,
  height: 200,
  penColor: '#000'
});
pad.toDataURL();              // 이미지 데이터 URL

// FormWizard
const wizard = new Forms.FormWizard('#wizard', {
  steps: [
    { title: 'Step 1', content: '<form>...</form>' },
    { title: 'Step 2', content: '<form>...</form>' }
  ],
  onComplete: () => console.log('완료')
});
```

---

## 6. Tooltips

```javascript
const Tooltips = await IMCAT.use('tooltips');

// Tooltip
const tooltip = new Tooltips.Tooltip('#btn', {
  content: '도움말 내용',
  placement: 'top',           // 'top' | 'bottom' | 'left' | 'right'
  trigger: 'hover'            // 'hover' | 'focus' | 'click'
});

// data 속성으로 자동 초기화
// <button data-tooltip="내용" data-placement="top">버튼</button>
Tooltips.initAll();

// Popover
const popover = new Tooltips.Popover('#info', {
  title: '상세 정보',
  content: '<p>내용</p>',
  placement: 'bottom'
});
```

---

## 7. Navigation

```javascript
const Navigation = await IMCAT.use('navigation');

// Tabs (HTML 구조: [role="tablist"], [role="tab"], [role="tabpanel"])
const tabs = new Navigation.Tabs('#tabs', {
  activeIndex: 0,
  onChange: (index) => console.log(index)
});

// Accordion (HTML: .accordion__item > .accordion__header + .accordion__content)
const accordion = new Navigation.Accordion('#accordion', {
  multiple: false,
  expandFirst: true
});
accordion.expand(0);
accordion.collapse(0);
accordion.toggle(0);

// Collapse
const collapse = new Navigation.Collapse('#content', { expanded: false });
collapse.toggle();

// MegaMenu
const megamenu = new Navigation.MegaMenu('#nav', { trigger: 'hover' });

// TreeView
const tree = new Navigation.TreeView('#tree', {
  onNodeClick: (node) => console.log(node)
});
```

---

## 8. Pagination

```javascript
const PaginationModule = await IMCAT.use('pagination');

// Pagination
const pagination = new PaginationModule.Pagination('#paging', {
  totalItems: 100,
  itemsPerPage: 10,
  showInfo: true,
  align: 'center',
  onChange: (pageData) => loadData(pageData.startIndex, pageData.endIndex)
});

// DataPaginator (데이터 + 렌더링 + 페이지네이션 통합)
const paginator = new PaginationModule.DataPaginator({
  container: '#list',
  data: dataArray,
  itemsPerPage: 10,
  renderItem: (item, idx) => `<div>${item.name}</div>`
});
paginator.filter(item => item.active);
paginator.search('검색어', ['name', 'email']);
```

---

## 9. Carousel

```javascript
const CarouselModule = await IMCAT.use('carousel');

const carousel = new CarouselModule.Carousel('#slider', {
  items: [
    { src: 'img1.jpg', title: '제목1' },
    { content: '<div>커스텀</div>' }
  ],
  autoplay: true,
  autoplaySpeed: 5000,
  effect: 'fade',             // 'slide' | 'fade' | 'scale' | 'flip' | 'cube'
  slidesToShow: 1,
  responsive: [
    { breakpoint: 768, settings: { slidesToShow: 2 } }
  ],
  onSlideChange: (curr, prev) => console.log(curr)
});

carousel.next();
carousel.prev();
carousel.goTo(2);

// Lightbox
const lightbox = new CarouselModule.Lightbox({
  selector: 'img[data-lightbox]'
});
```

---

## 10. Stepper

```javascript
const StepperModule = await IMCAT.use('stepper');

// Stepper
const stepper = new StepperModule.Stepper('#stepper', {
  steps: [
    { title: 'Step 1', icon: 'person' },
    { title: 'Step 2', icon: 'settings' },
    { title: '완료', icon: 'check' }
  ],
  orientation: 'horizontal',
  linear: false,
  onChange: (step) => console.log(step)
});
stepper.next();
stepper.complete(0);

// VerticalStepper (인라인 콘텐츠)
const vStepper = new StepperModule.VerticalStepper('#vstepper', {
  steps: [
    { title: 'Step 1', content: '<form>...</form>' },
    { title: 'Step 2', content: '<form>...</form>' }
  ],
  editable: true
});
```

---

## 11-20. 기타 모듈

### Selectors

```javascript
const Selectors = await IMCAT.use('selectors');
const auto = new Selectors.Autocomplete('#search', {
  source: ['Apple', 'Banana'],  // 또는 async (query) => fetch(...)
  onSelect: (item) => console.log(item)
});
```

### Pickers

```javascript
const Pickers = await IMCAT.use('pickers');
const datePicker = new Pickers.DatePicker('#date', { format: 'YYYY-MM-DD' });
const timePicker = new Pickers.TimePicker('#time', { format: 'HH:mm' });
const colorPicker = new Pickers.ColorPicker('#color', { defaultColor: '#3b82f6' });
```

### Scroll

```javascript
const Scroll = await IMCAT.use('scroll');
const virtualScroll = new Scroll.VirtualScroll('#list', {
  items: largeArray,
  itemHeight: 50,
  renderItem: (item, i) => `<div>${item.name}</div>`
});
```

### Data-Viz

```javascript
const DataViz = await IMCAT.use('data-viz');
const table = new DataViz.DataTable('#table', {
  data: users,
  columns: [
    { key: 'name', title: '이름', sortable: true },
    { key: 'email', title: '이메일' }
  ],
  paginate: true
});
```

### Advanced-UI

```javascript
const AdvancedUI = await IMCAT.use('advanced-ui');
const split = new AdvancedUI.SplitPane('#editor', {
  direction: 'horizontal',
  initialSizes: [30, 70]
});
```

### Text-Editors

```javascript
const TextEditors = await IMCAT.use('text-editors');
const editor = new TextEditors.RichTextEditor('#editor', {
  onChange: (html) => console.log(html)
});
editor.getContent();
editor.setContent('<p>내용</p>');
```

### Social

```javascript
const Social = await IMCAT.use('social');
const chat = new Social.ChatUI('#chat', {
  currentUser: { id: 'user1', name: '나' },
  onSend: (msg) => sendToServer(msg)
});
chat.addMessage({ user: 'other', text: '안녕!' });
```

### Security-Input

```javascript
const SecurityInput = await IMCAT.use('security-input');
const otp = new SecurityInput.OTPInput('#otp', {
  length: 6,
  onComplete: (code) => verifyOTP(code)
});
```

### Media-Viewer

```javascript
const MediaViewer = await IMCAT.use('media-viewer');
const player = new MediaViewer.VideoPlayer('#video', {
  src: 'video.mp4',
  customControls: true
});
```

### Live-Status

```javascript
const LiveStatus = await IMCAT.use('live-status');
const status = new LiveStatus.OnlineStatus('#avatar', {
  status: 'online',           // 'online' | 'offline' | 'away' | 'busy'
  pulse: true
});
status.setStatus('away');
```

---

## 공통 패턴

### 인스턴스 등록 (필수)

```javascript
const instance = new Module.Component(selector, options);
IMCAT.view.registerInstance(instance);  // SPA 페이지 전환 시 자동 destroy
```

### 수동 정리

```javascript
instance.destroy();  // 수동으로 정리할 때
```

### 옵션 구조

```javascript
{
  // 기능 옵션
  option1: value,
  
  // 콜백
  onChange: (data) => {},
  onDestroy: () => {}
}
```

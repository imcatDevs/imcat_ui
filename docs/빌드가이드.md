# 빌드 가이드

## 요구 사항

- Node.js 18+
- npm 9+

## 설치

```bash
git clone https://github.com/user/imcat-ui.git
cd imcat-ui
npm install
```

---

## 빌드 명령어

### 전체 빌드

```bash
npm run build
```

실행 순서:

1. JavaScript 번들링 (Rollup)
2. CSS 컴파일 (Sass)
3. 폰트 복사

### 개별 빌드

```bash
# JavaScript만
npm run build:js

# CSS만
npm run build:css

# 폰트 복사
npm run copy:fonts
```

---

## 빌드 출력

```text
dist/
├── imcat-ui.js          # ESM (개발용)
├── imcat-ui.min.js      # ESM (프로덕션)
├── imcat-ui.umd.js      # UMD (브라우저 직접 사용)
├── imcat-ui.css         # 전체 스타일
└── fonts/               # 폰트 파일
    ├── Montserrat-Regular.ttf
    ├── Montserrat-SemiBold.ttf
    └── ...
```

### 파일 크기

| 파일 | 크기 (압축) |
|------|-------------|
| imcat-ui.min.js | ~48KB |
| imcat-ui.css | ~107KB |

---

## 개발 서버

```bash
npm run serve
```

- 로컬 서버: <http://localhost:3000>
- 예제 페이지: <http://localhost:3000/examples/>

---

## Rollup 설정

`rollup.config.js`:

```javascript
export default {
  input: 'src/core/index.js',
  output: [
    {
      file: 'dist/imcat-ui.js',
      format: 'esm'
    },
    {
      file: 'dist/imcat-ui.min.js',
      format: 'esm',
      plugins: [terser()]
    },
    {
      file: 'dist/imcat-ui.umd.js',
      format: 'umd',
      name: 'IMCAT'
    }
  ]
};
```

---

## CSS 빌드 옵션

### 압축 빌드 (기본)

```bash
sass src/styles/imcat-ui.scss dist/imcat-ui.css --style compressed
```

### 소스맵 포함

```bash
sass src/styles/imcat-ui.scss dist/imcat-ui.css --source-map
```

### 개발용 (비압축)

```bash
sass src/styles/imcat-ui.scss dist/imcat-ui.css --style expanded
```

---

## 테스트

### 단위 테스트

```bash
npm test
```

### 테스트 커버리지

```bash
npm run test:coverage
```

### 특정 테스트 실행

```bash
npm test -- --grep "DOM"
```

---

## 린트

### JavaScript

```bash
npm run lint
npm run lint:fix  # 자동 수정
```

### 설정 파일

- `.eslintrc.cjs` - ESLint 설정
- `.editorconfig` - 에디터 설정

---

## TypeScript 정의

TypeScript 정의 파일:

```text
types/
└── imcat-ui.d.ts
```

### 사용 방법

```typescript
import IMCAT from '@imcat-ckim/catui';

// 타입 지원
IMCAT.toast.success('완료');
const modal = await IMCAT.modal({ title: '알림' });
```

---

## npm 배포

### 버전 업데이트

```bash
npm version patch  # 0.0.x
npm version minor  # 0.x.0
npm version major  # x.0.0
```

### 배포

```bash
npm publish
```

### .npmignore

배포에서 제외되는 파일:

- `src/`
- `tests/`
- `examples/`
- `docs/`

---

## 프로젝트 스크립트 전체 목록

```json
{
  "scripts": {
    "build": "rollup -c && npm run build:css && npm run copy:fonts",
    "build:js": "rollup -c",
    "build:css": "sass src/styles/imcat-ui.scss dist/imcat-ui.css --style compressed --no-source-map",
    "copy:fonts": "node scripts/copy-fonts.js",
    "serve": "npx serve .",
    "test": "vitest",
    "test:coverage": "vitest --coverage",
    "lint": "eslint src/",
    "lint:fix": "eslint src/ --fix",
    "docs": "jsdoc -c jsdoc.json"
  }
}
```

---

## 개발 워크플로우

### 1. 기능 개발

```bash
# 브랜치 생성
git checkout -b feature/new-feature

# 개발 서버 실행
npm run serve

# 코드 작성...
```

### 2. 테스트 및 린트

```bash
npm run lint
npm test
```

### 3. 빌드 확인

```bash
npm run build
```

### 4. 커밋

```bash
git add .
git commit -m "feat: 새 기능 추가"
git push origin feature/new-feature
```

---

## 트러블슈팅

### Sass 경고

```text
Deprecation Warning: Using / for division is deprecated
```

해결: `math.div()` 함수 사용

```scss
@use 'sass:math';
// 변경 전
$half: $size / 2;
// 변경 후
$half: math.div($size, 2);
```

### 모듈 로드 실패

```text
Failed to load module: overlays
```

확인사항:

1. `dist/` 폴더에 빌드 결과물 존재 확인
2. 모듈 파일 경로 확인

### 폰트 404

```text
GET /fonts/Montserrat-Regular.ttf 404
```

해결:

```bash
npm run copy:fonts
```

---

## 파일 감시 (Watch)

### JavaScript

```bash
rollup -c --watch
```

### CSS

```bash
sass --watch src/styles/imcat-ui.scss:dist/imcat-ui.css
```

### 동시 감시

```bash
npm-run-all --parallel watch:js watch:css
```

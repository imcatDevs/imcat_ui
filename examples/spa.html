<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IMCAT UI - SPA ë¼ìš°í„° (íŒŒì¼ ê¸°ë°˜ + data-href)</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #f5f5f5;
    }

    .header {
      background: white;
      border-bottom: 1px solid #e0e0e0;
      padding: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    h1 {
      color: #333;
      margin-bottom: 20px;
    }

    .nav {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .nav a {
      padding: 10px 20px;
      background: #007bff;
      color: white;
      text-decoration: none;
      border-radius: 4px;
      transition: background 0.3s;
    }

    .nav a:hover {
      background: #0056b3;
    }

    .nav a.active {
      background: #0056b3;
      font-weight: bold;
    }

    .content {
      padding: 30px 20px;
    }

    #app {
      background: white;
      border-radius: 8px;
      padding: 30px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      min-height: 400px;
    }

    .page-title {
      color: #333;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #007bff;
    }

    .info-box {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 4px;
      margin: 20px 0;
    }

    .router-info {
      background: #d4edda;
      color: #155724;
      padding: 15px;
      border-radius: 4px;
      margin-top: 20px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
    }

    button {
      background: #28a745;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 10px;
    }

    button:hover {
      background: #218838;
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="container">
      <h1>ğŸš€ IMCAT UI - SPA ë¼ìš°í„°</h1>
      <nav class="nav">
        <a href="#home" data-route>í™ˆ</a>
        <a href="#about" data-route>ì†Œê°œ</a>
        <a href="#products" data-route>ì œí’ˆ</a>
        <a href="#contact" data-route>ì—°ë½ì²˜</a>
      </nav>
    </div>
  </div>

  <div class="content">
    <div class="container">
      <div id="app">
        <div class="page-title">ë¡œë”© ì¤‘...</div>
      </div>
      <div class="router-info" id="router-info"></div>
    </div>
  </div>

  <script type="module">
    import IMCAT from '../dist/imcat-ui.js';

    window.IMCAT = IMCAT;

    // ë¼ìš°í„° ì„¤ì •
    IMCAT.view.setContainer('#app');

    // ë¼ìš°í„° í›… ì„¤ì •
    IMCAT.view.beforeLoad((path, from) => {
      console.log(`ğŸ”„ í˜ì´ì§€ ì „í™˜: ${from || '(ì´ˆê¸°)'} â†’ ${path}`);
      updateRouterInfo(`ë¡œë”©: ${path}`);
    });

    IMCAT.view.afterLoad((path) => {
      console.log(`âœ… í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ: ${path}`);
      updateRouterInfo(`í˜„ì¬ í˜ì´ì§€: ${path}`);
      updateActiveNav(path);
    });

    IMCAT.view.onError((error) => {
      console.error('âŒ ë¼ìš°í„° ì—ëŸ¬:', error);
      IMCAT('#app').html(`
        <div class="page-title" style="color: #dc3545;">í˜ì´ì§€ ë¡œë“œ ì‹¤íŒ¨</div>
        <div class="info-box">
          <strong>ì—ëŸ¬:</strong> ${error.message}<br>
          <button onclick="location.hash='#home'">í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
        </div>
      `);
    });

    // ë„¤ë¹„ê²Œì´ì…˜ ë§í¬ í´ë¦­ ì²˜ë¦¬
    IMCAT('[data-route]').on('click', (e) => {
      e.preventDefault();
      const path = e.target.getAttribute('href').slice(1);
      renderPage(path);
    });

    // ë¼ìš°í„° ì •ë³´ ì—…ë°ì´íŠ¸
    function updateRouterInfo(message) {
      const info = {
        message,
        currentPath: IMCAT.view.current(),
        hash: window.location.hash,
        params: IMCAT.view.params()
      };
      IMCAT('#router-info').text(JSON.stringify(info, null, 2));
    }

    // í™œì„± ë„¤ë¹„ê²Œì´ì…˜ ì—…ë°ì´íŠ¸
    function updateActiveNav(path) {
      IMCAT('[data-route]').removeClass('active');
      IMCAT(`[href="#${path}"]`).addClass('active');
    }

    // í˜ì´ì§€ ë Œë”ë§ (íŒŒì¼ì´ ì—†ìœ¼ë¯€ë¡œ ì¸ë¼ì¸ìœ¼ë¡œ)
    function renderPage(path) {
      let content = '';

      switch(path) {
        case 'home':
          content = `
            <div class="page-title">ğŸ  í™ˆ</div>
            <div class="info-box">
              <h2>IMCAT UI Frameworkì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!</h2>
              <p>ê²½ëŸ‰í™”ëœ ES6+ ê¸°ë°˜ í”„ë¡ íŠ¸ì—”ë“œ í”„ë ˆì„ì›Œí¬ì…ë‹ˆë‹¤.</p>
              <ul style="margin-top: 15px; margin-left: 20px;">
                <li>ì œë¡œ ë¹Œë“œ (ê°œë°œ ì‹œ)</li>
                <li>ë™ì  ëª¨ë“ˆ ë¡œë”©</li>
                <li>SPA ë¼ìš°íŒ…</li>
                <li>ë³´ì•ˆ ìš°ì„  ì„¤ê³„</li>
              </ul>
            </div>
            <button onclick="IMCAT.emit('page:action', {page: 'home', action: 'clicked'})">
              ì „ì—­ ì´ë²¤íŠ¸ ë°œí–‰
            </button>
          `;
          break;

        case 'about':
          content = `
            <div class="page-title">â„¹ï¸ ì†Œê°œ</div>
            <div class="info-box">
              <h2>í”„ë ˆì„ì›Œí¬ íŠ¹ì§•</h2>
              <p><strong>ë²„ì „:</strong> ${IMCAT.version}</p>
              <p><strong>í¬ê¸°:</strong> ~22KB (minified)</p>
              <p><strong>ë¸Œë¼ìš°ì € ì§€ì›:</strong> Chrome 90+, Firefox 88+, Safari 14+</p>
            </div>
            <div class="info-box">
              <h3>ì½”ì–´ ëª¨ë“ˆ</h3>
              <ul style="margin-left: 20px;">
                <li>DOM - jQuery ìŠ¤íƒ€ì¼ API</li>
                <li>Event - ì´ë²¤íŠ¸ ë²„ìŠ¤</li>
                <li>Router - SPA ë¼ìš°íŒ…</li>
                <li>Loader - ë™ì  ëª¨ë“ˆ ë¡œë”©</li>
                <li>Loading - ë¡œë”© ì¸ë””ì¼€ì´í„°</li>
                <li>API - HTTP í†µì‹ </li>
                <li>Security - XSS ë°©ì–´</li>
                <li>Utils - ìœ í‹¸ë¦¬í‹°</li>
              </ul>
            </div>
          `;
          break;

        case 'products':
          content = `
            <div class="page-title">ğŸ“¦ ì œí’ˆ</div>
            <div class="info-box">
              <h2>ì œí’ˆ ëª©ë¡</h2>
              <div id="product-list">ë¡œë”© ì¤‘...</div>
            </div>
          `;
          // ë¹„ë™ê¸° ë°ì´í„° ë¡œë“œ ì‹œë®¬ë ˆì´ì…˜
          setTimeout(() => {
            const products = [
              { id: 1, name: 'IMCAT UI Core', price: 'Free' },
              { id: 2, name: 'IMCAT UI Pro', price: '$29' },
              { id: 3, name: 'IMCAT UI Enterprise', price: '$99' }
            ];

            let html = '<ul style="margin-left: 20px;">';
            products.forEach(p => {
              html += `<li><strong>${p.name}</strong> - ${p.price}</li>`;
            });
            html += '</ul>';

            IMCAT('#product-list').html(html);
          }, 500);
          break;

        case 'contact':
          content = `
            <div class="page-title">ğŸ“§ ì—°ë½ì²˜</div>
            <div class="info-box">
              <h2>ë¬¸ì˜í•˜ê¸°</h2>
              <form id="contact-form" style="margin-top: 15px;">
                <div style="margin-bottom: 15px;">
                  <input type="text" id="name" placeholder="ì´ë¦„" style="padding: 8px; width: 100%; max-width: 400px;">
                </div>
                <div style="margin-bottom: 15px;">
                  <input type="email" id="email" placeholder="ì´ë©”ì¼" style="padding: 8px; width: 100%; max-width: 400px;">
                </div>
                <div style="margin-bottom: 15px;">
                  <textarea id="message" placeholder="ë©”ì‹œì§€" style="padding: 8px; width: 100%; max-width: 400px; height: 100px;"></textarea>
                </div>
                <button type="submit">ì „ì†¡</button>
              </form>
              <div id="form-result" style="margin-top: 15px;"></div>
            </div>
          `;
          // í¼ ì œì¶œ ì²˜ë¦¬
          setTimeout(() => {
            IMCAT('#contact-form').on('submit', (e) => {
              e.preventDefault();
              const name = IMCAT('#name').get(0).value;
              const email = IMCAT('#email').get(0).value;
              const message = IMCAT('#message').get(0).value;

              // ë³´ì•ˆ ì²˜ë¦¬
              const safeName = IMCAT.escape(name);
              const safeEmail = IMCAT.escape(email);
              const safeMessage = IMCAT.escape(message);

              IMCAT('#form-result').html(`
                <div style="background: #d4edda; color: #155724; padding: 15px; border-radius: 4px;">
                  <strong>âœ… ì „ì†¡ ì™„ë£Œ!</strong><br>
                  ì´ë¦„: ${safeName}<br>
                  ì´ë©”ì¼: ${safeEmail}<br>
                  ë©”ì‹œì§€: ${safeMessage}
                </div>
              `);
            });
          }, 100);
          break;

        default:
          content = `
            <div class="page-title" style="color: #dc3545;">404 - í˜ì´ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</div>
            <div class="info-box">
              <p>ìš”ì²­í•˜ì‹  í˜ì´ì§€ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
              <button onclick="location.hash='#home'">í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
            </div>
          `;
      }

      IMCAT('#app').html(content);
      updateRouterInfo(`í˜„ì¬ í˜ì´ì§€: ${path}`);
      IMCAT.view.currentPath = path;
      updateActiveNav(path);
    }

    // ì „ì—­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    IMCAT.on('page:action', (data) => {
      console.log('ğŸ“¢ í˜ì´ì§€ ì•¡ì…˜:', data);
      alert(`í˜ì´ì§€ ì•¡ì…˜ ë°œìƒ!\n${JSON.stringify(data, null, 2)}`);
    });

    // ì´ˆê¸° ë¼ìš°íŒ…
    IMCAT.ready(() => {
      const hash = window.location.hash.slice(1) || 'home';
      renderPage(hash);
      console.log('âœ… SPA ë¼ìš°í„° ì¤€ë¹„ ì™„ë£Œ!');
    });

    // ë¸Œë¼ìš°ì € ë’¤ë¡œ/ì•ìœ¼ë¡œ ê°€ê¸° ì²˜ë¦¬
    window.addEventListener('hashchange', () => {
      const path = window.location.hash.slice(1) || 'home';
      renderPage(path);
    });
  </script>
</body>
</html>

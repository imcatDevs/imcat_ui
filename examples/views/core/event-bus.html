<!-- Breadcrumb -->
<div class="page-title-box">
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="#home">Home</a></li>
      <li class="breadcrumb-item"><a href="#core">Core</a></li>
      <li class="breadcrumb-item active">Event Bus</li>
    </ol>
  </nav>
  <h1 class="page-title">Event Bus</h1>
  <p class="page-description">Pub/Sub íŒ¨í„´ ì´ë²¤íŠ¸ ì‹œìŠ¤í…œ - ì»´í¬ë„ŒíŠ¸ ê°„ ëŠìŠ¨í•œ ê²°í•© í†µì‹ </p>
</div>

<div class="row">
  <!-- ê¸°ë³¸ ì´ë²¤íŠ¸ -->
  <div class="col-lg-6">
    <div class="card mb-4">
      <div class="card__header">
        <h2 class="card__title">ğŸ“¡ ê¸°ë³¸ ì´ë²¤íŠ¸ (on/emit)</h2>
        <p class="card__description">ì´ë²¤íŠ¸ êµ¬ë… ë° ë°œí–‰</p>
      </div>
      <div class="card__body">
        <div class="demo-section">
          <h4>ì´ë²¤íŠ¸ ë°œí–‰</h4>
          <input type="text" id="event_name" class="form-control" placeholder="ì´ë²¤íŠ¸ ì´ë¦„" value="user:greeting" style="margin-bottom: 0.5rem;">
          <input type="text" id="event_data" class="form-control" placeholder="ë°ì´í„°" value="ì•ˆë…•í•˜ì„¸ìš”!" style="margin-bottom: 0.5rem;">
          <button class="btn btn--primary btn--sm" onclick="emitEvent()">ì´ë²¤íŠ¸ ë°œí–‰</button>
          
          <h4 style="margin-top: 1rem;">ì´ë²¤íŠ¸ ë¡œê·¸</h4>
          <div id="event_log" class="log-box"></div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- ì¼íšŒì„± ì´ë²¤íŠ¸ -->
  <div class="col-lg-6">
    <div class="card mb-4">
      <div class="card__header">
        <h2 class="card__title">ğŸ¯ ì¼íšŒì„± ì´ë²¤íŠ¸ (once)</h2>
        <p class="card__description">í•œ ë²ˆë§Œ ì‹¤í–‰ë˜ê³  ìë™ í•´ì œ</p>
      </div>
      <div class="card__body">
        <div class="demo-section">
          <h4>ì¼íšŒì„± êµ¬ë… í…ŒìŠ¤íŠ¸</h4>
          <button class="btn btn--secondary btn--sm" onclick="subscribeOnce()">onceë¡œ êµ¬ë…</button>
          <button class="btn btn--primary btn--sm" onclick="emitOnceEvent()">ì´ë²¤íŠ¸ ë°œí–‰</button>
          
          <h4 style="margin-top: 1rem;">ë¡œê·¸</h4>
          <div id="once_log" class="log-box"></div>
          <small style="color: var(--text-secondary);">onceë¡œ êµ¬ë… í›„ ì´ë²¤íŠ¸ë¥¼ ì—¬ëŸ¬ ë²ˆ ë°œí–‰í•´ë³´ì„¸ìš”</small>
        </div>
      </div>
    </div>
  </div>
  
  <!-- ì‹¤ì‹œê°„ ì±„íŒ… ì‹œë®¬ë ˆì´ì…˜ -->
  <div class="col-12">
    <div class="card mb-4">
      <div class="card__header">
        <h2 class="card__title">ğŸ’¬ ì‹¤ì „ ì˜ˆì œ: ì±„íŒ… ì‹œë®¬ë ˆì´ì…˜</h2>
        <p class="card__description">ì´ë²¤íŠ¸ ë²„ìŠ¤ë¥¼ í™œìš©í•œ ì»´í¬ë„ŒíŠ¸ ê°„ í†µì‹ </p>
      </div>
      <div class="card__body">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
          <!-- ì‚¬ìš©ì A -->
          <div class="chat-user">
            <h4 style="color: #2563eb;">ğŸ‘¤ ì‚¬ìš©ì A</h4>
            <div id="chat_a" class="chat-box"></div>
            <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
              <input type="text" id="msg_a" class="form-control" placeholder="ë©”ì‹œì§€ ì…ë ¥..." onkeypress="if(event.key==='Enter')sendMessage('A')">
              <button class="btn btn--primary btn--sm" onclick="sendMessage('A')">ì „ì†¡</button>
            </div>
          </div>
          
          <!-- ì‚¬ìš©ì B -->
          <div class="chat-user">
            <h4 style="color: #dc2626;">ğŸ‘¤ ì‚¬ìš©ì B</h4>
            <div id="chat_b" class="chat-box"></div>
            <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
              <input type="text" id="msg_b" class="form-control" placeholder="ë©”ì‹œì§€ ì…ë ¥..." onkeypress="if(event.key==='Enter')sendMessage('B')">
              <button class="btn btn--primary btn--sm" onclick="sendMessage('B')">ì „ì†¡</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- ì•Œë¦¼ ì‹œìŠ¤í…œ -->
  <div class="col-12">
    <div class="card mb-4">
      <div class="card__header">
        <h2 class="card__title">ğŸ”” ì‹¤ì „ ì˜ˆì œ: ì•Œë¦¼ ì‹œìŠ¤í…œ</h2>
        <p class="card__description">ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì•Œë¦¼ ì´ë²¤íŠ¸ êµ¬ë…</p>
      </div>
      <div class="card__body">
        <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
          <button class="btn btn--success btn--sm" onclick="sendNotification('success', 'ì‘ì—…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!')">ì„±ê³µ ì•Œë¦¼</button>
          <button class="btn btn--danger btn--sm" onclick="sendNotification('error', 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤!')">ì˜¤ë¥˜ ì•Œë¦¼</button>
          <button class="btn btn--warning btn--sm" onclick="sendNotification('warning', 'ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤!')">ê²½ê³  ì•Œë¦¼</button>
          <button class="btn btn--secondary btn--sm" onclick="sendNotification('info', 'ìƒˆë¡œìš´ ì •ë³´ê°€ ìˆìŠµë‹ˆë‹¤.')">ì •ë³´ ì•Œë¦¼</button>
        </div>
        
        <div id="notification_area"></div>
      </div>
    </div>
  </div>
</div>

<!-- ì‚¬ìš©ë²• -->
<div class="row">
  <div class="col-12">
    <div class="card">
      <div class="card__header">
        <h2 class="card__title">ğŸ“– API ë ˆí¼ëŸ°ìŠ¤</h2>
      </div>
      <div class="card__body">
        <pre><code>// ì´ë²¤íŠ¸ êµ¬ë…
const unsubscribe = IMCAT.on('user:login', (data) => {
  console.log('ë¡œê·¸ì¸:', data.username);
});

// êµ¬ë… ì·¨ì†Œ
unsubscribe();
// ë˜ëŠ”: IMCAT.off('user:login', handler);

// ì¼íšŒì„± êµ¬ë… (í•œ ë²ˆë§Œ ì‹¤í–‰)
IMCAT.once('data:loaded', () => {
  console.log('ë°ì´í„° ë¡œë“œ ì™„ë£Œ - ì´ ë©”ì‹œì§€ëŠ” í•œ ë²ˆë§Œ í‘œì‹œë©ë‹ˆë‹¤');
});

// ì´ë²¤íŠ¸ ë°œí–‰
IMCAT.emit('user:login', { username: 'í™ê¸¸ë™' });

// ì—¬ëŸ¬ ë°ì´í„° ì „ë‹¬
IMCAT.emit('order:created', { id: 1, total: 50000 }, { notify: true });</code></pre>
      </div>
    </div>
  </div>
</div>

<style>
  .demo-section h4 {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--text-secondary);
    margin-bottom: 0.5rem;
  }
  
  .form-control {
    width: 100%;
    padding: 0.5rem 0.75rem;
    border: 1px solid var(--border-color);
    border-radius: 6px;
    font-size: 0.875rem;
    background: var(--bg-primary);
    color: var(--text-primary);
  }
  
  .log-box {
    background: #1e1e1e;
    color: #d4d4d4;
    padding: 1rem;
    border-radius: 8px;
    font-family: monospace;
    font-size: 0.8125rem;
    min-height: 120px;
    max-height: 200px;
    overflow-y: auto;
  }
  
  .log-entry {
    margin-bottom: 0.25rem;
    padding: 0.25rem 0;
    border-bottom: 1px solid #333;
  }
  
  .log-time {
    color: #6a9955;
  }
  
  .log-event {
    color: #569cd6;
  }
  
  .log-data {
    color: #ce9178;
  }
  
  .chat-box {
    background: var(--bg-secondary);
    border-radius: 8px;
    padding: 1rem;
    min-height: 150px;
    max-height: 200px;
    overflow-y: auto;
  }
  
  .chat-message {
    padding: 0.5rem 0.75rem;
    border-radius: 12px;
    margin-bottom: 0.5rem;
    max-width: 80%;
    font-size: 0.875rem;
  }
  
  .chat-message--sent {
    background: var(--primary-color);
    color: white;
    margin-left: auto;
  }
  
  .chat-message--received {
    background: var(--bg-primary);
    border: 1px solid var(--border-color);
  }
  
  .notification-toast {
    padding: 0.75rem 1rem;
    border-radius: 8px;
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    animation: slideIn 0.3s ease;
  }
  
  @keyframes slideIn {
    from { opacity: 0; transform: translateX(-20px); }
    to { opacity: 1; transform: translateX(0); }
  }
  
  .notification-toast--success { background: #dcfce7; color: #166534; border-left: 4px solid #22c55e; }
  .notification-toast--error { background: #fee2e2; color: #991b1b; border-left: 4px solid #ef4444; }
  .notification-toast--warning { background: #fef3c7; color: #92400e; border-left: 4px solid #f59e0b; }
  .notification-toast--info { background: #dbeafe; color: #1e40af; border-left: 4px solid #3b82f6; }
</style>

<script>
  // ê¸°ë³¸ ì´ë²¤íŠ¸ êµ¬ë…
  IMCAT.on('user:greeting', (data) => {
    addLog('event_log', 'user:greeting', data);
  });
  
  function emitEvent() {
    const name = document.getElementById('event_name').value;
    const data = document.getElementById('event_data').value;
    IMCAT.emit(name, data);
  }
  
  function addLog(elementId, event, data) {
    const log = document.getElementById(elementId);
    const time = new Date().toLocaleTimeString();
    log.innerHTML += `
      <div class="log-entry">
        <span class="log-time">[${time}]</span>
        <span class="log-event">${event}</span>: 
        <span class="log-data">${JSON.stringify(data)}</span>
      </div>
    `;
    log.scrollTop = log.scrollHeight;
  }
  
  // ì¼íšŒì„± ì´ë²¤íŠ¸
  window.onceSubscribed = window.onceSubscribed || false;
  
  function subscribeOnce() {
    if (window.onceSubscribed) {
      addLog('once_log', 'system', 'ì´ë¯¸ êµ¬ë…ë¨ (onceëŠ” í•œ ë²ˆë§Œ ì‹¤í–‰ë©ë‹ˆë‹¤)');
      return;
    }
    
    IMCAT.once('special:event', (data) => {
      addLog('once_log', 'special:event', data + ' (ì´ ë©”ì‹œì§€ëŠ” í•œ ë²ˆë§Œ í‘œì‹œë©ë‹ˆë‹¤)');
      window.onceSubscribed = false;
    });
    
    window.onceSubscribed = true;
    addLog('once_log', 'system', 'onceë¡œ êµ¬ë… ì™„ë£Œ');
  }
  
  function emitOnceEvent() {
    IMCAT.emit('special:event', 'ì¼íšŒì„± ì´ë²¤íŠ¸ ë°œìƒ!');
    addLog('once_log', 'emit', 'ì´ë²¤íŠ¸ ë°œí–‰ë¨');
  }
  
  // ì±„íŒ… ì‹œë®¬ë ˆì´ì…˜
  IMCAT.on('chat:message', ({ from, message }) => {
    const chatA = document.getElementById('chat_a');
    const chatB = document.getElementById('chat_b');
    
    if (from === 'A') {
      chatA.innerHTML += `<div class="chat-message chat-message--sent">${message}</div>`;
      chatB.innerHTML += `<div class="chat-message chat-message--received">ğŸ‘¤A: ${message}</div>`;
    } else {
      chatB.innerHTML += `<div class="chat-message chat-message--sent">${message}</div>`;
      chatA.innerHTML += `<div class="chat-message chat-message--received">ğŸ‘¤B: ${message}</div>`;
    }
    
    chatA.scrollTop = chatA.scrollHeight;
    chatB.scrollTop = chatB.scrollHeight;
  });
  
  function sendMessage(from) {
    const input = document.getElementById(`msg_${from.toLowerCase()}`);
    const message = input.value.trim();
    if (!message) return;
    
    IMCAT.emit('chat:message', { from, message });
    input.value = '';
  }
  
  // ì•Œë¦¼ ì‹œìŠ¤í…œ
  IMCAT.on('notification', ({ type, message }) => {
    const area = document.getElementById('notification_area');
    const icons = {
      success: 'âœ…',
      error: 'âŒ',
      warning: 'âš ï¸',
      info: 'â„¹ï¸'
    };
    
    const toast = document.createElement('div');
    toast.className = `notification-toast notification-toast--${type}`;
    toast.innerHTML = `${icons[type]} ${message}`;
    area.prepend(toast);
    
    // 5ì´ˆ í›„ ìë™ ì œê±°
    setTimeout(() => toast.remove(), 5000);
  });
  
  function sendNotification(type, message) {
    IMCAT.emit('notification', { type, message });
  }
</script>

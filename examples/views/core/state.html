<!-- Breadcrumb -->
<div class="page-title-box">
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="#home">Home</a></li>
      <li class="breadcrumb-item"><a href="#core">Core</a></li>
      <li class="breadcrumb-item active">State Manager</li>
    </ol>
  </nav>
  <h1 class="page-title">State Manager</h1>
  <p class="page-description">ë¦¬ì•¡í‹°ë¸Œ ìƒíƒœ ê´€ë¦¬ - watch, computed, ìë™ UI ì—…ë°ì´íŠ¸</p>
</div>

<div class="row">
  <!-- ê¸°ë³¸ ìƒíƒœ ê´€ë¦¬ -->
  <div class="col-lg-6">
    <div class="card mb-4">
      <div class="card__header">
        <h2 class="card__title">ğŸ“Š ì¹´ìš´í„° ì˜ˆì œ</h2>
        <p class="card__description">ìƒíƒœ ë³€ê²½ ê°ì§€ (watch)</p>
      </div>
      <div class="card__body">
        <div class="demo-section">
          <div class="counter-display">
            <span id="counter_value">0</span>
          </div>
          <div style="display: flex; gap: 0.5rem; justify-content: center; margin-top: 1rem;">
            <button class="btn btn--danger btn--sm" onclick="decrement()">-1</button>
            <button class="btn btn--secondary btn--sm" onclick="resetCounter()">ë¦¬ì…‹</button>
            <button class="btn btn--success btn--sm" onclick="increment()">+1</button>
          </div>
          
          <h4 style="margin-top: 1.5rem;">ë³€ê²½ ë¡œê·¸</h4>
          <div id="counter_log" class="log-box"></div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- ê°ì²´ ìƒíƒœ ê´€ë¦¬ -->
  <div class="col-lg-6">
    <div class="card mb-4">
      <div class="card__header">
        <h2 class="card__title">ğŸ‘¤ ì‚¬ìš©ì í”„ë¡œí•„ ì˜ˆì œ</h2>
        <p class="card__description">ê°ì²´ ìƒíƒœ ê´€ë¦¬</p>
      </div>
      <div class="card__body">
        <div class="demo-section">
          <div class="profile-card">
            <div class="profile-avatar" id="profile_avatar">?</div>
            <div class="profile-info">
              <div class="profile-name" id="profile_name">ì´ë¦„ ì—†ìŒ</div>
              <div class="profile-email" id="profile_email">ì´ë©”ì¼ ì—†ìŒ</div>
              <div class="profile-status" id="profile_status">ì˜¤í”„ë¼ì¸</div>
            </div>
          </div>
          
          <div style="margin-top: 1rem;">
            <input type="text" id="input_name" class="form-control" placeholder="ì´ë¦„" style="margin-bottom: 0.5rem;">
            <input type="email" id="input_email" class="form-control" placeholder="ì´ë©”ì¼" style="margin-bottom: 0.5rem;">
            <div style="display: flex; gap: 0.5rem;">
              <button class="btn btn--primary btn--sm" onclick="updateProfile()">í”„ë¡œí•„ ì—…ë°ì´íŠ¸</button>
              <button class="btn btn--success btn--sm" onclick="toggleStatus()">ìƒíƒœ í† ê¸€</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- ì¥ë°”êµ¬ë‹ˆ ì˜ˆì œ -->
  <div class="col-12">
    <div class="card mb-4">
      <div class="card__header">
        <h2 class="card__title">ğŸ›’ ì‹¤ì „ ì˜ˆì œ: ì¥ë°”êµ¬ë‹ˆ</h2>
        <p class="card__description">ë³µì¡í•œ ìƒíƒœ ê´€ë¦¬ì™€ ìë™ ê³„ì‚°</p>
      </div>
      <div class="card__body">
        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 1.5rem;">
          <!-- ìƒí’ˆ ëª©ë¡ -->
          <div>
            <h4>ìƒí’ˆ ëª©ë¡</h4>
            <div class="product-list" id="product_list"></div>
          </div>
          
          <!-- ì¥ë°”êµ¬ë‹ˆ ìš”ì•½ -->
          <div>
            <h4>ì¥ë°”êµ¬ë‹ˆ</h4>
            <div class="cart-summary">
              <div class="cart-items" id="cart_items"></div>
              <div class="cart-total">
                <span>ì´ ê¸ˆì•¡:</span>
                <span id="cart_total">â‚©0</span>
              </div>
              <div class="cart-count">
                <span>ìƒí’ˆ ìˆ˜:</span>
                <span id="cart_count">0ê°œ</span>
              </div>
              <button class="btn btn--danger btn--sm" onclick="clearCart()" style="width: 100%; margin-top: 0.5rem;">ì¥ë°”êµ¬ë‹ˆ ë¹„ìš°ê¸°</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- ì „ì—­ ìƒíƒœ -->
  <div class="col-12">
    <div class="card mb-4">
      <div class="card__header">
        <h2 class="card__title">ğŸŒ ì „ì—­ ìƒíƒœ (GlobalState)</h2>
        <p class="card__description">ì•± ì „ì²´ì—ì„œ ê³µìœ ë˜ëŠ” ìƒíƒœ</p>
      </div>
      <div class="card__body">
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;">
          <div class="state-box">
            <h4>í…Œë§ˆ</h4>
            <div id="global_theme" class="state-value">light</div>
            <button class="btn btn--secondary btn--sm" onclick="toggleGlobalTheme()">í† ê¸€</button>
          </div>
          <div class="state-box">
            <h4>ì–¸ì–´</h4>
            <div id="global_lang" class="state-value">ko</div>
            <button class="btn btn--secondary btn--sm" onclick="toggleGlobalLang()">í† ê¸€</button>
          </div>
          <div class="state-box">
            <h4>ë¡œê·¸ì¸</h4>
            <div id="global_login" class="state-value">false</div>
            <button class="btn btn--secondary btn--sm" onclick="toggleGlobalLogin()">í† ê¸€</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ì‚¬ìš©ë²• -->
<div class="row">
  <div class="col-12">
    <div class="card">
      <div class="card__header">
        <h2 class="card__title">ğŸ“– API ë ˆí¼ëŸ°ìŠ¤</h2>
      </div>
      <div class="card__body">
        <pre><code>// ìƒíƒœ ìƒì„±
const state = IMCAT.state.create({ count: 0, user: null });

// ìƒíƒœ ë³€ê²½ ê°ì§€
state.watch('count', (newValue, oldValue) => {
  console.log(`count: ${oldValue} â†’ ${newValue}`);
});

// ìƒíƒœ ë³€ê²½ (ìë™ìœ¼ë¡œ watch ì½œë°± í˜¸ì¶œ)
state.count++;
state.user = { name: 'í™ê¸¸ë™' };

// ë°°ì¹˜ ì—…ë°ì´íŠ¸ (ì—¬ëŸ¬ ë³€ê²½ì„ í•œ ë²ˆì—)
state.batch(() => {
  state.count = 10;
  state.user = { name: 'ê¹€ì² ìˆ˜' };
}); // watchê°€ í•œ ë²ˆë§Œ í˜¸ì¶œë¨

// ì „ì—­ ìƒíƒœ (GlobalState)
const appStore = IMCAT.globalState.use('app', { theme: 'light', lang: 'ko' });
appStore.theme = 'dark';     // ìƒíƒœ ë³€ê²½
console.log(appStore.theme); // 'dark'</code></pre>
      </div>
    </div>
  </div>
</div>

<style>
  .demo-section h4 {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--text-secondary);
    margin-bottom: 0.5rem;
  }
  
  .form-control {
    width: 100%;
    padding: 0.5rem 0.75rem;
    border: 1px solid var(--border-color);
    border-radius: 6px;
    font-size: 0.875rem;
    background: var(--bg-primary);
    color: var(--text-primary);
  }
  
  .counter-display {
    text-align: center;
    font-size: 4rem;
    font-weight: 700;
    color: var(--primary-color);
    padding: 1rem;
  }
  
  .log-box {
    background: var(--bg-secondary);
    padding: 0.75rem;
    border-radius: 8px;
    font-family: monospace;
    font-size: 0.75rem;
    max-height: 120px;
    overflow-y: auto;
  }
  
  .profile-card {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: var(--bg-secondary);
    border-radius: 12px;
  }
  
  .profile-avatar {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: var(--primary-color);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    font-weight: 600;
  }
  
  .profile-name {
    font-weight: 600;
    font-size: 1.125rem;
  }
  
  .profile-email {
    font-size: 0.875rem;
    color: var(--text-secondary);
  }
  
  .profile-status {
    font-size: 0.75rem;
    padding: 0.25rem 0.5rem;
    border-radius: 12px;
    display: inline-block;
    margin-top: 0.25rem;
  }
  
  .profile-status.online {
    background: #dcfce7;
    color: #166534;
  }
  
  .profile-status.offline {
    background: #fee2e2;
    color: #991b1b;
  }
  
  .product-list {
    display: grid;
    gap: 0.75rem;
  }
  
  .product-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 0.75rem;
    background: var(--bg-secondary);
    border-radius: 8px;
  }
  
  .product-info {
    flex: 1;
  }
  
  .product-name {
    font-weight: 600;
  }
  
  .product-price {
    color: var(--primary-color);
    font-weight: 600;
  }
  
  .cart-summary {
    background: var(--bg-secondary);
    padding: 1rem;
    border-radius: 8px;
  }
  
  .cart-items {
    min-height: 100px;
    margin-bottom: 1rem;
  }
  
  .cart-item {
    display: flex;
    justify-content: space-between;
    padding: 0.5rem 0;
    border-bottom: 1px solid var(--border-color);
    font-size: 0.875rem;
  }
  
  .cart-total, .cart-count {
    display: flex;
    justify-content: space-between;
    padding: 0.5rem 0;
    font-weight: 600;
  }
  
  .cart-total {
    font-size: 1.125rem;
    color: var(--primary-color);
  }
  
  .state-box {
    text-align: center;
    padding: 1rem;
    background: var(--bg-secondary);
    border-radius: 8px;
  }
  
  .state-box h4 {
    margin-bottom: 0.5rem;
    font-size: 0.875rem;
    color: var(--text-secondary);
  }
  
  .state-value {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--primary-color);
    margin-bottom: 0.75rem;
  }
</style>

<script>
  // ============================================
  // ì¹´ìš´í„° ì˜ˆì œ
  // ============================================
  if (window.counterState && window.counterState.destroy) window.counterState.destroy();
  window.counterState = IMCAT.state.create({ count: 0 });
  
  window.counterState.watch('count', (newVal, oldVal) => {
    document.getElementById('counter_value').textContent = newVal;
    const log = document.getElementById('counter_log');
    log.innerHTML += `<div>${oldVal} â†’ ${newVal}</div>`;
    log.scrollTop = log.scrollHeight;
  });
  
  function increment() { window.counterState.count++; }
  function decrement() { window.counterState.count--; }
  function resetCounter() { window.counterState.count = 0; }
  
  // ============================================
  // í”„ë¡œí•„ ì˜ˆì œ
  // ============================================
  if (window.profileState && window.profileState.destroy) window.profileState.destroy();
  window.profileState = IMCAT.state.create({
    name: '',
    email: '',
    isOnline: false
  });
  
  window.profileState.watch('name', (name) => {
    document.getElementById('profile_name').textContent = name || 'ì´ë¦„ ì—†ìŒ';
    document.getElementById('profile_avatar').textContent = name ? name[0] : '?';
  });
  
  window.profileState.watch('email', (email) => {
    document.getElementById('profile_email').textContent = email || 'ì´ë©”ì¼ ì—†ìŒ';
  });
  
  window.profileState.watch('isOnline', (isOnline) => {
    const el = document.getElementById('profile_status');
    el.textContent = isOnline ? 'ì˜¨ë¼ì¸' : 'ì˜¤í”„ë¼ì¸';
    el.className = 'profile-status ' + (isOnline ? 'online' : 'offline');
  });
  
  function updateProfile() {
    window.profileState.name = document.getElementById('input_name').value;
    window.profileState.email = document.getElementById('input_email').value;
  }
  
  function toggleStatus() {
    window.profileState.isOnline = !window.profileState.isOnline;
  }
  
  // ============================================
  // ì¥ë°”êµ¬ë‹ˆ ì˜ˆì œ
  // ============================================
  var products = [
    { id: 1, name: 'ë§¥ë¶ í”„ë¡œ', price: 2500000 },
    { id: 2, name: 'ì•„ì´í° 15', price: 1200000 },
    { id: 3, name: 'ì—ì–´íŒŸ í”„ë¡œ', price: 350000 },
    { id: 4, name: 'ì•„ì´íŒ¨ë“œ ë¯¸ë‹ˆ', price: 700000 }
  ];
  
  if (window.cartState && window.cartState.destroy) window.cartState.destroy();
  window.cartState = IMCAT.state.create({ items: [] });
  
  // ìƒí’ˆ ëª©ë¡ ë Œë”ë§
  document.getElementById('product_list').innerHTML = products.map(p => `
    <div class="product-item">
      <div class="product-info">
        <div class="product-name">${p.name}</div>
        <div class="product-price">â‚©${p.price.toLocaleString()}</div>
      </div>
      <button class="btn btn--primary btn--sm" onclick="addToCart(${p.id})">ë‹´ê¸°</button>
    </div>
  `).join('');
  
  window.cartState.watch('items', (items) => {
    // ì¥ë°”êµ¬ë‹ˆ ì•„ì´í…œ ë Œë”ë§
    const cartItemsEl = document.getElementById('cart_items');
    if (items.length === 0) {
      cartItemsEl.innerHTML = '<div style="text-align: center; color: var(--text-secondary); padding: 2rem;">ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤</div>';
    } else {
      cartItemsEl.innerHTML = items.map(item => `
        <div class="cart-item">
          <span>${item.name}</span>
          <span>â‚©${item.price.toLocaleString()}</span>
        </div>
      `).join('');
    }
    
    // ì´ ê¸ˆì•¡ ê³„ì‚°
    const total = items.reduce((sum, item) => sum + item.price, 0);
    document.getElementById('cart_total').textContent = `â‚©${total.toLocaleString()}`;
    document.getElementById('cart_count').textContent = `${items.length}ê°œ`;
  });
  
  function addToCart(productId) {
    const product = products.find(p => p.id === productId);
    window.cartState.items = [...window.cartState.items, product];
  }
  
  function clearCart() {
    window.cartState.items = [];
  }
  
  // ì´ˆê¸° ë Œë”ë§
  window.cartState.items = [];
  
  // ============================================
  // ì „ì—­ ìƒíƒœ ì˜ˆì œ
  // ============================================
  // GlobalState.use()ë¡œ ìŠ¤í† ì–´ ìƒì„±
  var appStore = IMCAT.globalState.use('app', { 
    theme: 'light', 
    lang: 'ko', 
    isLoggedIn: false 
  });
  
  function toggleGlobalTheme() {
    const next = appStore.theme === 'light' ? 'dark' : 'light';
    appStore.theme = next;
    document.getElementById('global_theme').textContent = next;
  }
  
  function toggleGlobalLang() {
    const next = appStore.lang === 'ko' ? 'en' : 'ko';
    appStore.lang = next;
    document.getElementById('global_lang').textContent = next;
  }
  
  function toggleGlobalLogin() {
    appStore.isLoggedIn = !appStore.isLoggedIn;
    document.getElementById('global_login').textContent = String(appStore.isLoggedIn);
  }
</script>

<!-- Breadcrumb -->
<div class="page-title-box">
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="#home">Home</a></li>
      <li class="breadcrumb-item"><a href="#core">Core</a></li>
      <li class="breadcrumb-item active">Utils</li>
    </ol>
  </nav>
  <h1 class="page-title">Utils</h1>
  <p class="page-description">ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ëª¨ìŒ - íƒ€ì…ì²´í¬, debounce, throttle, ëœë¤ID ë“±</p>
</div>

<div class="row">
  <!-- íƒ€ì… ì²´í¬ -->
  <div class="col-lg-6">
    <div class="card mb-4">
      <div class="card__header">
        <h2 class="card__title">ğŸ” íƒ€ì… ì²´í¬</h2>
        <p class="card__description">ê°’ì˜ íƒ€ì…ì„ í™•ì¸í•˜ëŠ” í•¨ìˆ˜ë“¤</p>
      </div>
      <div class="card__body">
        <div class="demo-section">
          <input type="text" id="type_input" class="form-control" placeholder="ê°’ ì…ë ¥" value="Hello World" style="margin-bottom: 0.5rem;">
          <button class="btn btn--primary btn--sm" onclick="checkType()">íƒ€ì… ì²´í¬</button>
          
          <div id="type_result" class="result-grid" style="margin-top: 1rem;"></div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- ëœë¤ ID -->
  <div class="col-lg-6">
    <div class="card mb-4">
      <div class="card__header">
        <h2 class="card__title">ğŸ² ëœë¤ ID ìƒì„±</h2>
        <p class="card__description">ê³ ìœ í•œ ID ìƒì„±</p>
      </div>
      <div class="card__body">
        <div class="demo-section">
          <input type="text" id="id_prefix" class="form-control" placeholder="ì ‘ë‘ì‚¬ (ì„ íƒ)" value="user" style="margin-bottom: 0.5rem;">
          <button class="btn btn--primary btn--sm" onclick="generateId()">ID ìƒì„±</button>
          <button class="btn btn--secondary btn--sm" onclick="generateMultipleIds()">5ê°œ ìƒì„±</button>
          
          <div id="id_result" class="result-box" style="margin-top: 1rem;"></div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Debounce -->
  <div class="col-lg-6">
    <div class="card mb-4">
      <div class="card__header">
        <h2 class="card__title">â±ï¸ Debounce</h2>
        <p class="card__description">ì—°ì† í˜¸ì¶œì„ ì§€ì—°ì‹œì¼œ ë§ˆì§€ë§‰ í˜¸ì¶œë§Œ ì‹¤í–‰</p>
      </div>
      <div class="card__body">
        <div class="demo-section">
          <input type="text" id="debounce_input" class="form-control" placeholder="ì…ë ¥í•´ë³´ì„¸ìš” (300ms debounce)" style="margin-bottom: 0.5rem;">
          <small style="color: var(--text-secondary);">ì…ë ¥ì„ ë©ˆì¶˜ í›„ 300ms ë’¤ì— ë¡œê·¸ê°€ ì¶”ê°€ë©ë‹ˆë‹¤</small>
          
          <h4 style="margin-top: 1rem;">í˜¸ì¶œ ë¡œê·¸</h4>
          <div id="debounce_log" class="log-box"></div>
          <div style="display: flex; justify-content: space-between; margin-top: 0.5rem;">
            <span>ì¼ë°˜ í˜¸ì¶œ: <strong id="normal_count">0</strong>íšŒ</span>
            <span>Debounce í˜¸ì¶œ: <strong id="debounce_count">0</strong>íšŒ</span>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Throttle -->
  <div class="col-lg-6">
    <div class="card mb-4">
      <div class="card__header">
        <h2 class="card__title">ğŸš¦ Throttle</h2>
        <p class="card__description">ì¼ì • ê°„ê²©ìœ¼ë¡œë§Œ í•¨ìˆ˜ ì‹¤í–‰ í—ˆìš©</p>
      </div>
      <div class="card__body">
        <div class="demo-section">
          <div id="throttle_area" class="throttle-area">
            ë§ˆìš°ìŠ¤ë¥¼ ì›€ì§ì—¬ë³´ì„¸ìš”
          </div>
          <small style="color: var(--text-secondary);">100ms ê°„ê²©ìœ¼ë¡œë§Œ ìœ„ì¹˜ê°€ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤</small>
          
          <h4 style="margin-top: 1rem;">í˜¸ì¶œ ë¡œê·¸</h4>
          <div id="throttle_log" class="log-box"></div>
          <div style="display: flex; justify-content: space-between; margin-top: 0.5rem;">
            <span>ì¼ë°˜ í˜¸ì¶œ: <strong id="mouse_count">0</strong>íšŒ</span>
            <span>Throttle í˜¸ì¶œ: <strong id="throttle_count">0</strong>íšŒ</span>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- ê°ì²´ ì¡°ì‘ -->
  <div class="col-lg-6">
    <div class="card mb-4">
      <div class="card__header">
        <h2 class="card__title">ğŸ“¦ ê°ì²´ ì¡°ì‘</h2>
        <p class="card__description">extend, clone í•¨ìˆ˜</p>
      </div>
      <div class="card__body">
        <div class="demo-section">
          <h4>extend (ê°ì²´ ë³‘í•©)</h4>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-bottom: 0.5rem;">
            <input type="text" id="extend_obj1" class="form-control" value='{"a":1,"b":2}' style="font-family: monospace; font-size: 0.75rem;">
            <input type="text" id="extend_obj2" class="form-control" value='{"b":3,"c":4}' style="font-family: monospace; font-size: 0.75rem;">
          </div>
          <button class="btn btn--primary btn--sm" onclick="showExtend()">ë³‘í•© ì‹¤í–‰</button>
          <div id="extend_result" class="result-box" style="margin-top: 0.5rem;"></div>
          
          <h4 style="margin-top: 1rem;">clone (ê¹Šì€ ë³µì‚¬)</h4>
          <input type="text" id="clone_obj" class="form-control" value='{"a":1,"nested":{"b":2}}' style="font-family: monospace; font-size: 0.75rem; margin-bottom: 0.5rem;">
          <button class="btn btn--primary btn--sm" onclick="showClone()">ë³µì‚¬ í›„ ìˆ˜ì •</button>
          <div id="clone_result" class="result-box" style="margin-top: 0.5rem;"></div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- XSS ë³´ì•ˆ -->
  <div class="col-lg-6">
    <div class="card mb-4">
      <div class="card__header">
        <h2 class="card__title">ğŸ›¡ï¸ XSS ë³´ì•ˆ</h2>
        <p class="card__description">escape, sanitize í•¨ìˆ˜</p>
      </div>
      <div class="card__body">
        <div class="demo-section">
          <input type="text" id="xss_input" class="form-control" placeholder="HTML ì…ë ¥" value="<script>alert('XSS')</script><b>Bold</b>" style="margin-bottom: 0.5rem;">
          <button class="btn btn--primary btn--sm" onclick="testEscape()">escape</button>
          <button class="btn btn--secondary btn--sm" onclick="testSanitize()">sanitize</button>
          
          <h4 style="margin-top: 1rem;">ê²°ê³¼</h4>
          <div id="xss_result" class="result-box"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ì‚¬ìš©ë²• -->
<div class="row">
  <div class="col-12">
    <div class="card">
      <div class="card__header">
        <h2 class="card__title">ğŸ“– API ë ˆí¼ëŸ°ìŠ¤</h2>
      </div>
      <div class="card__body">
        <pre><code>// íƒ€ì… ì²´í¬
IMCAT.isString('hello'); // true
IMCAT.isNumber(123); // true
IMCAT.isArray([1, 2, 3]); // true
IMCAT.isObject({ a: 1 }); // true
IMCAT.isFunction(() => {}); // true

// ëœë¤ ID ìƒì„±
IMCAT.randomId(); // 'id_a1b2c3d4'
IMCAT.randomId('user'); // 'user_e5f6g7h8'

// Debounce (ì—°ì† í˜¸ì¶œ ì§€ì—°)
const search = IMCAT.debounce((query) => {
  console.log('ê²€ìƒ‰:', query);
}, 300);

// Throttle (í˜¸ì¶œ ë¹ˆë„ ì œí•œ)
const handleScroll = IMCAT.throttle(() => {
  console.log('ìŠ¤í¬ë¡¤');
}, 100);

// ê°ì²´ ë³‘í•©
const merged = IMCAT.extend({}, obj1, obj2);

// ê¹Šì€ ë³µì‚¬
const copy = IMCAT.clone(original);

// XSS ë³´ì•ˆ
IMCAT.escape('&lt;script&gt;'); // '&amp;lt;script&amp;gt;'
IMCAT.sanitize('&lt;script&gt;alert()&lt;/script&gt;&lt;b&gt;text&lt;/b&gt;'); // '&lt;b&gt;text&lt;/b&gt;'</code></pre>
      </div>
    </div>
  </div>
</div>

<style>
  .demo-section h4 {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--text-secondary);
    margin-bottom: 0.5rem;
  }
  
  .form-control {
    width: 100%;
    padding: 0.5rem 0.75rem;
    border: 1px solid var(--border-color);
    border-radius: 6px;
    font-size: 0.875rem;
    background: var(--bg-primary);
    color: var(--text-primary);
  }
  
  .result-box {
    padding: 1rem;
    background: var(--bg-secondary);
    border-radius: 8px;
    font-family: monospace;
    font-size: 0.8125rem;
    word-break: break-all;
    min-height: 3rem;
  }
  
  .result-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.5rem;
  }
  
  .type-check {
    padding: 0.5rem;
    background: var(--bg-secondary);
    border-radius: 6px;
    font-size: 0.8125rem;
    display: flex;
    justify-content: space-between;
  }
  
  .type-check--true {
    background: #dcfce7;
  }
  
  .log-box {
    background: #1e1e1e;
    color: #d4d4d4;
    padding: 0.75rem;
    border-radius: 8px;
    font-family: monospace;
    font-size: 0.75rem;
    min-height: 100px;
    max-height: 150px;
    overflow-y: auto;
  }
  
  .throttle-area {
    background: linear-gradient(135deg, var(--primary-color) 0%, #a78bfa 100%);
    color: white;
    padding: 2rem;
    border-radius: 8px;
    text-align: center;
    font-weight: 600;
    cursor: crosshair;
  }
</style>

<script>
  // íƒ€ì… ì²´í¬
  function checkType() {
    let value = document.getElementById('type_input').value;
    
    // íƒ€ì… ë³€í™˜ ì‹œë„
    if (value === 'true') value = true;
    else if (value === 'false') value = false;
    else if (value === 'null') value = null;
    else if (value === 'undefined') value = undefined;
    else if (!isNaN(Number(value)) && value !== '') value = Number(value);
    else if (value.startsWith('[') || value.startsWith('{')) {
      try { value = JSON.parse(value); } catch(e) {}
    }
    
    const checks = [
      { name: 'isString', result: IMCAT.isString(value) },
      { name: 'isNumber', result: IMCAT.isNumber(value) },
      { name: 'isArray', result: IMCAT.isArray(value) },
      { name: 'isObject', result: IMCAT.isObject(value) },
      { name: 'isFunction', result: IMCAT.isFunction(value) },
      { name: 'isBoolean', result: typeof value === 'boolean' }
    ];
    
    document.getElementById('type_result').innerHTML = checks.map(c => `
      <div class="type-check ${c.result ? 'type-check--true' : ''}">
        <span>${c.name}</span>
        <strong>${c.result}</strong>
      </div>
    `).join('');
  }
  
  // ëœë¤ ID
  function generateId() {
    const prefix = document.getElementById('id_prefix').value;
    const id = IMCAT.randomId(prefix || undefined);
    document.getElementById('id_result').textContent = id;
  }
  
  function generateMultipleIds() {
    const prefix = document.getElementById('id_prefix').value;
    const ids = [];
    for (let i = 0; i < 5; i++) {
      ids.push(IMCAT.randomId(prefix || undefined));
    }
    document.getElementById('id_result').innerHTML = ids.join('<br>');
  }
  
  // Debounce
  window.normalCount = window.normalCount || 0;
  window.debounceCount = window.debounceCount || 0;
  
  var debouncedLog = IMCAT.debounce((value) => {
    window.debounceCount++;
    const log = document.getElementById('debounce_log');
    log.innerHTML += `<div style="color: #22c55e;">[Debounced] ê°’: "${value}"</div>`;
    log.scrollTop = log.scrollHeight;
    document.getElementById('debounce_count').textContent = window.debounceCount;
  }, 300);
  
  document.getElementById('debounce_input').addEventListener('input', (e) => {
    window.normalCount++;
    document.getElementById('normal_count').textContent = window.normalCount;
    debouncedLog(e.target.value);
  });
  
  // Throttle
  window.mouseCount = window.mouseCount || 0;
  window.throttleCount = window.throttleCount || 0;
  
  var throttledLog = IMCAT.throttle((x, y) => {
    window.throttleCount++;
    const log = document.getElementById('throttle_log');
    log.innerHTML += `<div style="color: #3b82f6;">[Throttled] x: ${x}, y: ${y}</div>`;
    log.scrollTop = log.scrollHeight;
    document.getElementById('throttle_count').textContent = window.throttleCount;
  }, 100);
  
  document.getElementById('throttle_area').addEventListener('mousemove', (e) => {
    window.mouseCount++;
    document.getElementById('mouse_count').textContent = window.mouseCount;
    const rect = e.target.getBoundingClientRect();
    throttledLog(Math.round(e.clientX - rect.left), Math.round(e.clientY - rect.top));
  });
  
  // ê°ì²´ ì¡°ì‘
  function showExtend() {
    try {
      const obj1 = JSON.parse(document.getElementById('extend_obj1').value);
      const obj2 = JSON.parse(document.getElementById('extend_obj2').value);
      const result = IMCAT.extend({}, obj1, obj2);
      
      document.getElementById('extend_result').innerHTML = `
<strong>obj1:</strong> ${JSON.stringify(obj1)}<br>
<strong>obj2:</strong> ${JSON.stringify(obj2)}<br>
<strong style="color: var(--primary-color);">ê²°ê³¼:</strong> ${JSON.stringify(result)}
      `;
    } catch (e) {
      document.getElementById('extend_result').innerHTML = `<span style="color: #dc2626;">JSON íŒŒì‹± ì˜¤ë¥˜: ${e.message}</span>`;
    }
  }
  
  function showClone() {
    try {
      const original = JSON.parse(document.getElementById('clone_obj').value);
      const copy = IMCAT.clone(original);
      
      // ë³µì‚¬ë³¸ì˜ nested ê°’ ë³€ê²½
      if (copy.nested) copy.nested.b = 999;
      else if (copy.b) copy.b = 999;
      else copy.modified = true;
      
      document.getElementById('clone_result').innerHTML = `
<strong>ì›ë³¸:</strong> ${JSON.stringify(original)} (ë³€ê²½ ì•ˆë¨!)<br>
<strong style="color: var(--primary-color);">ë³µì‚¬ë³¸ (ìˆ˜ì • í›„):</strong> ${JSON.stringify(copy)}
      `;
    } catch (e) {
      document.getElementById('clone_result').innerHTML = `<span style="color: #dc2626;">JSON íŒŒì‹± ì˜¤ë¥˜: ${e.message}</span>`;
    }
  }
  
  // XSS ë³´ì•ˆ
  function testEscape() {
    const input = document.getElementById('xss_input').value;
    const escaped = IMCAT.escape(input);
    document.getElementById('xss_result').innerHTML = `
      <div><strong>escape ê²°ê³¼:</strong></div>
      <div style="margin-top: 0.5rem;">${escaped}</div>
    `;
  }
  
  function testSanitize() {
    const input = document.getElementById('xss_input').value;
    const sanitized = IMCAT.sanitize(input);
    document.getElementById('xss_result').innerHTML = `
      <div><strong>sanitize ê²°ê³¼:</strong></div>
      <div style="margin-top: 0.5rem;">${sanitized}</div>
      <div style="margin-top: 0.5rem; padding: 0.5rem; background: var(--bg-primary); border-radius: 4px;"><strong>ë Œë”ë§:</strong> ${sanitized}</div>
    `;
  }
  
  // ì´ˆê¸°í™”
  checkType();
  generateId();
  showExtend();
  showClone();
</script>

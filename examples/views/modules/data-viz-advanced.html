<!-- Breadcrumb -->
<div class="page-title-box">
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="#home">Home</a></li>
      <li class="breadcrumb-item"><a href="#" catui-href="views/modules/data-viz.html">Data Visualization</a></li>
      <li class="breadcrumb-item active">ê³ ê¸‰ ì˜ˆì œ</li>
    </ol>
  </nav>
  <h1 class="page-title">DataTable ê³ ê¸‰ ì˜ˆì œ</h1>
  <p class="page-description">ë§ˆìŠ¤í„°-ë””í…Œì¼ íŒ¨í„´ - JSON ë°ì´í„° ë¡œë“œ, í–‰ ì„ íƒ, ìƒì„¸ ì •ë³´ í‘œì‹œ</p>
</div>

<div class="row">
  <!-- ë§ˆìŠ¤í„° í…Œì´ë¸” (ì™¼ìª½) -->
  <div class="col-lg-5">
    <div class="card" style="height: calc(100vh - 220px); display: flex; flex-direction: column;">
      <div class="card__header" style="flex-shrink: 0;">
        <h2 class="card__title">ğŸ“‹ ì£¼ë¬¸ ëª©ë¡</h2>
        <p class="card__description">í–‰ì„ í´ë¦­í•˜ì—¬ ìƒì„¸ ì •ë³´ í™•ì¸</p>
      </div>
      <div class="card__body" style="flex: 1; overflow: hidden; position: relative;">
        <div id="master_table"></div>
      </div>
    </div>
  </div>

  <!-- ë””í…Œì¼ ì •ë³´ (ì˜¤ë¥¸ìª½) -->
  <div class="col-lg-7">
    <div class="card" style="height: calc(100vh - 220px); display: flex; flex-direction: column;">
      <div class="card__header" style="flex-shrink: 0; display: flex; justify-content: space-between; align-items: center;">
        <div>
          <h2 class="card__title">ğŸ“„ ì£¼ë¬¸ ìƒì„¸</h2>
          <p class="card__description" id="detail_subtitle">ì£¼ë¬¸ì„ ì„ íƒí•´ì£¼ì„¸ìš”</p>
        </div>
        <div id="detail_pagination" style="display: none;">
          <button id="prev_detail" class="btn btn--sm btn--secondary" disabled>
            <i class="material-icons-outlined" style="font-size: 18px;">chevron_left</i>
          </button>
          <span id="detail_page_info" style="margin: 0 0.75rem; font-size: 0.875rem;"></span>
          <button id="next_detail" class="btn btn--sm btn--secondary">
            <i class="material-icons-outlined" style="font-size: 18px;">chevron_right</i>
          </button>
        </div>
      </div>
      <div class="card__body" style="flex: 1; overflow-y: auto; position: relative;" id="detail_container">
        <!-- ì„ íƒ ì „ ì•ˆë‚´ -->
        <div id="detail_placeholder" class="detail-placeholder">
          <i class="material-icons-outlined" style="font-size: 64px; color: var(--text-secondary); opacity: 0.5;">touch_app</i>
          <p style="margin-top: 1rem; color: var(--text-secondary);">ì™¼ìª½ ëª©ë¡ì—ì„œ ì£¼ë¬¸ì„ ì„ íƒí•˜ì„¸ìš”</p>
        </div>
        
        <!-- ë””í…Œì¼ ì½˜í…ì¸  -->
        <div id="detail_content" style="display: none;"></div>
      </div>
    </div>
  </div>
</div>

<!-- ì¸ë¼ì¸ í¸ì§‘ í…Œì´ë¸” -->
<div class="row mt-4">
  <div class="col-12">
    <div class="card mb-4">
      <div class="card__header">
        <h2 class="card__title">âœï¸ ì¸ë¼ì¸ í¸ì§‘ í…Œì´ë¸”</h2>
        <p class="card__description">ì…€ì„ ë”ë¸”í´ë¦­í•˜ì—¬ ë°”ë¡œ í¸ì§‘</p>
      </div>
      <div class="card__body">
        <div id="demo_editable_table"></div>
      </div>
    </div>
  </div>
</div>

<!-- CRUD í…Œì´ë¸” -->
<div class="row">
  <div class="col-12">
    <div class="card mb-4">
      <div class="card__header">
        <h2 class="card__title">ğŸ—ƒï¸ CRUD í…Œì´ë¸”</h2>
        <p class="card__description">ì¶”ê°€, ìˆ˜ì •, ì‚­ì œ ì „ì²´ ê¸°ëŠ¥</p>
      </div>
      <div class="card__body">
        <div id="demo_crud_table"></div>
        
        <!-- ì¶”ê°€ í¼ -->
        <div id="add_form" style="margin-top: 1.5rem; padding: 1rem; background: var(--bg-secondary); border-radius: 8px; display: none;">
          <h4 style="margin-bottom: 1rem;">ìƒˆ í•­ëª© ì¶”ê°€</h4>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
            <input type="text" id="add_name" placeholder="ì´ë¦„" class="form-control">
            <input type="email" id="add_email" placeholder="ì´ë©”ì¼" class="form-control">
            <select id="add_department" class="form-control">
              <option value="">ë¶€ì„œ ì„ íƒ</option>
              <option value="ê°œë°œíŒ€">ê°œë°œíŒ€</option>
              <option value="ë””ìì¸íŒ€">ë””ìì¸íŒ€</option>
              <option value="ë§ˆì¼€íŒ…íŒ€">ë§ˆì¼€íŒ…íŒ€</option>
              <option value="ì¸ì‚¬íŒ€">ì¸ì‚¬íŒ€</option>
            </select>
            <input type="number" id="add_salary" placeholder="ì—°ë´‰" class="form-control">
          </div>
          <div style="margin-top: 1rem; display: flex; gap: 0.5rem;">
            <button onclick="saveNewRow()" class="btn btn--primary btn--sm">ì €ì¥</button>
            <button onclick="cancelAdd()" class="btn btn--secondary btn--sm">ì·¨ì†Œ</button>
          </div>
        </div>
        
        <!-- í¸ì§‘ ëª¨ë‹¬ -->
        <div id="edit_modal" style="position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 1000; display: none; align-items: center; justify-content: center;">
          <div style="background: var(--bg-primary); border-radius: 12px; padding: 1.5rem; width: 100%; max-width: 500px; margin: 1rem;">
            <h3 style="margin-bottom: 1rem;">í•­ëª© í¸ì§‘</h3>
            <input type="hidden" id="edit_index">
            <div style="display: grid; gap: 1rem;">
              <div>
                <label style="display: block; margin-bottom: 0.25rem; font-size: 0.875rem;">ì´ë¦„</label>
                <input type="text" id="edit_name" class="form-control">
              </div>
              <div>
                <label style="display: block; margin-bottom: 0.25rem; font-size: 0.875rem;">ì´ë©”ì¼</label>
                <input type="email" id="edit_email" class="form-control">
              </div>
              <div>
                <label style="display: block; margin-bottom: 0.25rem; font-size: 0.875rem;">ë¶€ì„œ</label>
                <select id="edit_department" class="form-control">
                  <option value="ê°œë°œíŒ€">ê°œë°œíŒ€</option>
                  <option value="ë””ìì¸íŒ€">ë””ìì¸íŒ€</option>
                  <option value="ë§ˆì¼€íŒ…íŒ€">ë§ˆì¼€íŒ…íŒ€</option>
                  <option value="ì¸ì‚¬íŒ€">ì¸ì‚¬íŒ€</option>
                </select>
              </div>
              <div>
                <label style="display: block; margin-bottom: 0.25rem; font-size: 0.875rem;">ì—°ë´‰</label>
                <input type="number" id="edit_salary" class="form-control">
              </div>
            </div>
            <div style="margin-top: 1.5rem; display: flex; gap: 0.5rem; justify-content: flex-end;">
              <button onclick="closeEditModal()" class="btn btn--secondary btn--sm">ì·¨ì†Œ</button>
              <button onclick="saveEdit()" class="btn btn--primary btn--sm">ì €ì¥</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ì‚¬ìš©ë²• -->
<div class="row">
  <div class="col-12">
    <div class="card">
      <div class="card__header">
        <h2 class="card__title">ğŸ“– ì‚¬ìš©ë²•</h2>
      </div>
      <div class="card__body">
        <h3 style="margin-bottom: 1rem;">JSON ë°ì´í„° ë¡œë“œ</h3>
        <pre><code>// fetchë¡œ JSON ë°ì´í„° ë¡œë“œ
IMCAT.loading.show('ë°ì´í„° ë¡œë”© ì¤‘...');

const response = await fetch('data/tabledata.json');
const jsonData = await response.json();

// í…Œì´ë¸”ì— ë°ì´í„° ì„¤ì •
table.setData(jsonData.orders);

IMCAT.loading.hide();</code></pre>

        <h3 style="margin-top: 2rem; margin-bottom: 1rem;">ë§ˆìŠ¤í„°-ë””í…Œì¼ íŒ¨í„´</h3>
        <pre><code>const masterTable = new DataViz.DataTable('#master', {
  data: orders,
  columns: [...],
  selectable: true,
  onRowClick: (row, index) => {
    // ë””í…Œì¼ ì˜ì—­ ì—…ë°ì´íŠ¸
    showDetail(row);
  }
});</code></pre>

        <h3 style="margin-top: 2rem; margin-bottom: 1rem;">ì„ íƒ ê´€ë ¨ API</h3>
        <pre><code>// ì„ íƒëœ í–‰ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
const selected = table.getSelectedRows();

// ì„ íƒëœ ì¸ë±ìŠ¤ ê°€ì ¸ì˜¤ê¸°
const indices = table.getSelectedIndices();

// ì„ íƒ ì´ë²¤íŠ¸
onSelect: (selectedData, indices) => {
  console.log('ì„ íƒë¨:', selectedData);
}</code></pre>
      </div>
    </div>
  </div>
</div>

<style>
  .detail-placeholder {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100%;
    min-height: 300px;
  }
  
  .detail-section {
    margin-bottom: 1.5rem;
    padding-bottom: 1.5rem;
    border-bottom: 1px solid var(--border-color);
  }
  
  .detail-section:last-child {
    margin-bottom: 0;
    padding-bottom: 0;
    border-bottom: none;
  }
  
  .detail-section h4 {
    font-size: 0.9375rem;
    font-weight: 600;
    margin-bottom: 1rem;
    color: var(--text-primary);
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  
  .detail-section h4 i {
    font-size: 20px;
    color: var(--primary-color);
  }
  
  .detail-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 1rem;
  }
  
  .detail-item {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }
  
  .detail-item label {
    font-size: 0.75rem;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  .detail-item span {
    font-size: 0.9375rem;
    color: var(--text-primary);
    font-weight: 500;
  }
  
  .items-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.875rem;
  }
  
  .items-table th,
  .items-table td {
    padding: 0.625rem 0.75rem;
    text-align: left;
    border-bottom: 1px solid var(--border-color);
  }
  
  .items-table th {
    background: var(--bg-secondary);
    font-weight: 600;
    font-size: 0.8125rem;
    color: var(--text-secondary);
  }
  
  .items-table tr:last-child td {
    border-bottom: none;
  }
  
  .items-table .text-right {
    text-align: right;
  }
  
  .status-badge {
    display: inline-block;
    padding: 0.25rem 0.625rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
  }
  
  .status-badge.completed { background: #dcfce7; color: #166534; }
  .status-badge.shipping { background: #dbeafe; color: #1e40af; }
  .status-badge.processing { background: #fef3c7; color: #92400e; }
  .status-badge.cancelled { background: #fee2e2; color: #991b1b; }
  .status-badge.pending { background: #f3f4f6; color: #4b5563; }

  /* ë§ˆìŠ¤í„° í…Œì´ë¸” í–‰ ì„ íƒ í•˜ì´ë¼ì´íŠ¸ */
  .data-table__row.active-row {
    background: rgba(102, 126, 234, 0.15) !important;
  }
  
  .data-table__row.active-row:hover {
    background: rgba(102, 126, 234, 0.2) !important;
  }

  /* ì¸ë¼ì¸ í¸ì§‘ ì…€ */
  .editable-cell {
    cursor: pointer;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    transition: background 0.2s;
  }
  
  .editable-cell:hover {
    background: rgba(102, 126, 234, 0.1);
  }

  /* í¼ ì»¨íŠ¸ë¡¤ */
  .form-control {
    width: 100%;
    padding: 0.5rem 0.75rem;
    border: 1px solid var(--border-color);
    border-radius: 6px;
    font-size: 0.875rem;
    background: var(--bg-primary);
    color: var(--text-primary);
  }
  
  .form-control:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
  }
</style>

<!-- JavaScript -->
<script type="module">
  const DataViz = await IMCAT.use('data-viz');
  const instances = [];
  
  let ordersData = [];
  let currentDetailPage = 1;
  let selectedOrder = null;
  const detailItemsPerPage = 5;

  // ============================================
  // JSON ë°ì´í„° ë¡œë“œ
  // ============================================
  
  async function loadData() {
    try {
      IMCAT.loading.show('ì£¼ë¬¸ ë°ì´í„° ë¡œë”© ì¤‘...');
      
      // ë¡œë”© ì‹œë®¬ë ˆì´ì…˜ (ì‹¤ì œë¡œëŠ” ì„œë²„ ì‘ë‹µ ì‹œê°„)
      await new Promise(r => setTimeout(r, 800));
      
      const response = await fetch('data/tabledata.json');
      if (!response.ok) throw new Error('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      
      const jsonData = await response.json();
      ordersData = jsonData.orders;
      
      initMasterTable();
      
    } catch (error) {
      console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
      document.getElementById('master_table').innerHTML = `
        <div style="padding: 2rem; text-align: center; color: var(--text-secondary);">
          <i class="material-icons-outlined" style="font-size: 48px; opacity: 0.5;">error_outline</i>
          <p style="margin-top: 1rem;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
        </div>
      `;
    } finally {
      IMCAT.loading.hide();
    }
  }

  // ============================================
  // ë§ˆìŠ¤í„° í…Œì´ë¸” ì´ˆê¸°í™”
  // ============================================
  
  function initMasterTable() {
    const masterTable = new DataViz.DataTable('#master_table', {
      data: ordersData,
      columns: [
        { field: 'id', title: 'ì£¼ë¬¸ë²ˆí˜¸', width: '120px' },
        { field: 'customer', title: 'ê³ ê°ëª…', width: '80px' },
        { field: 'date', title: 'ë‚ ì§œ', width: '100px' },
        { 
          field: 'status', 
          title: 'ìƒíƒœ', 
          width: '80px',
          render: (value) => {
            const statusClass = {
              'ì™„ë£Œ': 'completed',
              'ë°°ì†¡ì¤‘': 'shipping',
              'ì²˜ë¦¬ì¤‘': 'processing',
              'ì·¨ì†Œ': 'cancelled',
              'ëŒ€ê¸°': 'pending'
            };
            return `<span class="status-badge ${statusClass[value] || ''}">${value}</span>`;
          }
        },
        { 
          field: 'totalAmount', 
          title: 'ê¸ˆì•¡', 
          width: '110px',
          render: (value) => `â‚©${value.toLocaleString()}`
        }
      ],
      sortable: true,
      paginate: true,
      pageSize: 8,
      showInfo: true,
      onRowClick: (row, index) => {
        selectedOrder = row;
        currentDetailPage = 1;
        showDetail(row);
        
        // ì„ íƒëœ í–‰ í•˜ì´ë¼ì´íŠ¸
        document.querySelectorAll('.data-table__row').forEach(r => r.classList.remove('active-row'));
        const rows = document.querySelectorAll('#master_table .data-table__row');
        rows.forEach(r => {
          if (parseInt(r.dataset.index) === index) {
            r.classList.add('active-row');
          }
        });
      }
    });
    instances.push(masterTable);
    
    // ì²« ë²ˆì§¸ í–‰ ìë™ ì„ íƒ
    if (ordersData.length > 0) {
      selectedOrder = ordersData[0];
      showDetail(ordersData[0]);
      setTimeout(() => {
        const firstRow = document.querySelector('#master_table .data-table__row');
        if (firstRow) firstRow.classList.add('active-row');
      }, 100);
    }
  }

  // ============================================
  // ë””í…Œì¼ í‘œì‹œ
  // ============================================
  
  function showDetail(order) {
    document.getElementById('detail_placeholder').style.display = 'none';
    document.getElementById('detail_content').style.display = 'block';
    document.getElementById('detail_subtitle').textContent = `ì£¼ë¬¸ë²ˆí˜¸: ${order.id}`;
    
    // ìƒí’ˆ ëª©ë¡ í˜ì´ì§€ë„¤ì´ì…˜
    const totalItems = order.items.length;
    const totalPages = Math.ceil(totalItems / detailItemsPerPage);
    const showPagination = totalPages > 1;
    
    document.getElementById('detail_pagination').style.display = showPagination ? 'flex' : 'none';
    
    if (showPagination) {
      updateDetailPagination(totalPages);
    }
    
    renderDetailContent(order);
  }
  
  function updateDetailPagination(totalPages) {
    document.getElementById('detail_page_info').textContent = `${currentDetailPage} / ${totalPages}`;
    document.getElementById('prev_detail').disabled = currentDetailPage <= 1;
    document.getElementById('next_detail').disabled = currentDetailPage >= totalPages;
  }
  
  function renderDetailContent(order) {
    const start = (currentDetailPage - 1) * detailItemsPerPage;
    const end = start + detailItemsPerPage;
    const pageItems = order.items.slice(start, end);
    const totalPages = Math.ceil(order.items.length / detailItemsPerPage);
    
    const statusClass = {
      'ì™„ë£Œ': 'completed',
      'ë°°ì†¡ì¤‘': 'shipping',
      'ì²˜ë¦¬ì¤‘': 'processing',
      'ì·¨ì†Œ': 'cancelled',
      'ëŒ€ê¸°': 'pending'
    };
    
    document.getElementById('detail_content').innerHTML = `
      <!-- ê¸°ë³¸ ì •ë³´ -->
      <div class="detail-section">
        <h4><i class="material-icons-outlined">info</i> ê¸°ë³¸ ì •ë³´</h4>
        <div class="detail-grid">
          <div class="detail-item">
            <label>ì£¼ë¬¸ë²ˆí˜¸</label>
            <span>${order.id}</span>
          </div>
          <div class="detail-item">
            <label>ì£¼ë¬¸ì¼ì</label>
            <span>${order.date}</span>
          </div>
          <div class="detail-item">
            <label>ìƒíƒœ</label>
            <span class="status-badge ${statusClass[order.status] || ''}">${order.status}</span>
          </div>
          <div class="detail-item">
            <label>ì´ ê¸ˆì•¡</label>
            <span style="color: var(--primary-color); font-weight: 600;">â‚©${order.totalAmount.toLocaleString()}</span>
          </div>
        </div>
      </div>
      
      <!-- ê³ ê° ì •ë³´ -->
      <div class="detail-section">
        <h4><i class="material-icons-outlined">person</i> ê³ ê° ì •ë³´</h4>
        <div class="detail-grid">
          <div class="detail-item">
            <label>ê³ ê°ëª…</label>
            <span>${order.customer}</span>
          </div>
          <div class="detail-item">
            <label>ì´ë©”ì¼</label>
            <span>${order.email}</span>
          </div>
          <div class="detail-item">
            <label>ì—°ë½ì²˜</label>
            <span>${order.phone}</span>
          </div>
        </div>
      </div>
      
      <!-- ìƒí’ˆ ëª©ë¡ -->
      <div class="detail-section">
        <h4>
          <i class="material-icons-outlined">shopping_cart</i> 
          ìƒí’ˆ ëª©ë¡ (${order.items.length}ê°œ)
          ${totalPages > 1 ? `<span style="font-weight: 400; font-size: 0.8125rem; color: var(--text-secondary);"> - í˜ì´ì§€ ${currentDetailPage}/${totalPages}</span>` : ''}
        </h4>
        ${order.items.length > 0 ? `
          <table class="items-table">
            <thead>
              <tr>
                <th>ìƒí’ˆëª…</th>
                <th class="text-right">ìˆ˜ëŸ‰</th>
                <th class="text-right">ë‹¨ê°€</th>
                <th class="text-right">ì†Œê³„</th>
              </tr>
            </thead>
            <tbody>
              ${pageItems.map(item => `
                <tr>
                  <td>${item.product}</td>
                  <td class="text-right">${item.quantity}</td>
                  <td class="text-right">â‚©${item.price.toLocaleString()}</td>
                  <td class="text-right" style="font-weight: 600;">â‚©${(item.quantity * item.price).toLocaleString()}</td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        ` : `
          <div class="empty-state empty-state--sm">
            <div class="empty-state__icon">
              <i class="material-icons-outlined">shopping_cart</i>
            </div>
            <h3 class="empty-state__title">ìƒí’ˆ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
            <p class="empty-state__description">ë“±ë¡ëœ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>
          </div>
        `}
      </div>
      
      <!-- ë°°ì†¡ ì •ë³´ -->
      <div class="detail-section">
        <h4><i class="material-icons-outlined">local_shipping</i> ë°°ì†¡ ì •ë³´</h4>
        ${order.shipping.address ? `
          <div class="detail-grid">
            <div class="detail-item" style="grid-column: 1 / -1;">
              <label>ë°°ì†¡ì§€</label>
              <span>${order.shipping.address} (${order.shipping.zipcode})</span>
            </div>
            <div class="detail-item">
              <label>ë°°ì†¡ë°©ë²•</label>
              <span>${order.shipping.method || '-'}</span>
            </div>
            <div class="detail-item">
              <label>ìš´ì†¡ì¥ë²ˆí˜¸</label>
              <span>${order.shipping.trackingNo || '-'}</span>
            </div>
          </div>
        ` : `
          <div class="empty-state empty-state--sm">
            <div class="empty-state__icon">
              <i class="material-icons-outlined">local_shipping</i>
            </div>
            <h3 class="empty-state__title">ë°°ì†¡ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
            <p class="empty-state__description">ë°°ì†¡ì§€ê°€ ë“±ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>
          </div>
        `}
      </div>
      
      ${order.notes ? `
        <!-- ë©”ëª¨ -->
        <div class="detail-section">
          <h4><i class="material-icons-outlined">note</i> ë©”ëª¨</h4>
          <p style="margin: 0; padding: 0.75rem; background: var(--bg-secondary); border-radius: 6px; font-size: 0.875rem;">
            ${order.notes}
          </p>
        </div>
      ` : ''}
    `;
    
    if (totalPages > 1) {
      updateDetailPagination(totalPages);
    }
  }

  // ============================================
  // ë””í…Œì¼ í˜ì´ì§€ë„¤ì´ì…˜ ì´ë²¤íŠ¸
  // ============================================
  
  document.getElementById('prev_detail').addEventListener('click', () => {
    if (currentDetailPage > 1 && selectedOrder) {
      currentDetailPage--;
      renderDetailContent(selectedOrder);
    }
  });
  
  document.getElementById('next_detail').addEventListener('click', () => {
    if (selectedOrder) {
      const totalPages = Math.ceil(selectedOrder.items.length / detailItemsPerPage);
      if (currentDetailPage < totalPages) {
        currentDetailPage++;
        renderDetailContent(selectedOrder);
      }
    }
  });

  // ============================================
  // ì¸ë¼ì¸ í¸ì§‘ í…Œì´ë¸”
  // ============================================
  
  const editableSampleData = [
    { id: 1, name: 'í™ê¸¸ë™', email: 'hong@example.com', department: 'ê°œë°œíŒ€', status: 'í™œì„±' },
    { id: 2, name: 'ê¹€ì² ìˆ˜', email: 'kim@example.com', department: 'ë””ìì¸íŒ€', status: 'í™œì„±' },
    { id: 3, name: 'ì´ì˜í¬', email: 'lee@example.com', department: 'ë§ˆì¼€íŒ…íŒ€', status: 'ëŒ€ê¸°' },
    { id: 4, name: 'ë°•ì§€ë¯¼', email: 'park@example.com', department: 'ê°œë°œíŒ€', status: 'í™œì„±' },
    { id: 5, name: 'ìµœìˆ˜ì§„', email: 'choi@example.com', department: 'ì¸ì‚¬íŒ€', status: 'ë¹„í™œì„±' }
  ];
  
  const editableData = [...editableSampleData];
  
  const editableTable = new DataViz.DataTable('#demo_editable_table', {
    data: editableData,
    columns: [
      { field: 'id', title: 'ID', width: '60px' },
      { 
        field: 'name', 
        title: 'ì´ë¦„', 
        width: '150px',
        render: (value, row, idx) => `
          <span class="editable-cell" data-field="name" data-index="${idx}">${value}</span>
        `
      },
      { 
        field: 'email', 
        title: 'ì´ë©”ì¼',
        render: (value, row, idx) => `
          <span class="editable-cell" data-field="email" data-index="${idx}">${value}</span>
        `
      },
      { 
        field: 'department', 
        title: 'ë¶€ì„œ', 
        width: '120px',
        render: (value, row, idx) => `
          <span class="editable-cell" data-field="department" data-index="${idx}">${value}</span>
        `
      },
      { 
        field: 'status', 
        title: 'ìƒíƒœ', 
        width: '100px',
        render: (value) => {
          const color = value === 'í™œì„±' ? '#22c55e' : value === 'ëŒ€ê¸°' ? '#f59e0b' : '#ef4444';
          return `<span style="color: ${color}; font-weight: 500;">${value}</span>`;
        }
      }
    ],
    paginate: false,
    showInfo: false
  });
  instances.push(editableTable);

  // ì¸ë¼ì¸ í¸ì§‘ ì´ë²¤íŠ¸
  document.getElementById('demo_editable_table').addEventListener('dblclick', (e) => {
    const cell = e.target.closest('.editable-cell');
    if (!cell) return;

    const field = cell.dataset.field;
    const idx = parseInt(cell.dataset.index);
    const currentValue = editableData[idx][field];

    const input = document.createElement('input');
    input.type = 'text';
    input.value = currentValue;
    input.className = 'form-control';
    input.style.cssText = 'width: 100%; padding: 0.25rem 0.5rem; font-size: inherit;';
    
    cell.innerHTML = '';
    cell.appendChild(input);
    input.focus();
    input.select();

    const save = () => {
      const newValue = input.value;
      editableData[idx][field] = newValue;
      editableTable.setData(editableData);
    };

    input.addEventListener('blur', save);
    input.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') save();
      if (e.key === 'Escape') editableTable.refresh();
    });
  });

  // ============================================
  // CRUD í…Œì´ë¸”
  // ============================================
  
  const crudSampleData = [
    { id: 1, name: 'í™ê¸¸ë™', email: 'hong@example.com', department: 'ê°œë°œíŒ€', salary: 5000000 },
    { id: 2, name: 'ê¹€ì² ìˆ˜', email: 'kim@example.com', department: 'ë””ìì¸íŒ€', salary: 4500000 },
    { id: 3, name: 'ì´ì˜í¬', email: 'lee@example.com', department: 'ë§ˆì¼€íŒ…íŒ€', salary: 4800000 },
    { id: 4, name: 'ë°•ì§€ë¯¼', email: 'park@example.com', department: 'ê°œë°œíŒ€', salary: 5200000 },
    { id: 5, name: 'ìµœìˆ˜ì§„', email: 'choi@example.com', department: 'ì¸ì‚¬íŒ€', salary: 4300000 }
  ];
  
  let crudData = [...crudSampleData];
  let nextId = 100;

  const crudTable = new DataViz.DataTable('#demo_crud_table', {
    data: crudData,
    columns: [
      { field: 'id', title: 'ID', width: '60px' },
      { field: 'name', title: 'ì´ë¦„', width: '120px' },
      { field: 'email', title: 'ì´ë©”ì¼' },
      { field: 'department', title: 'ë¶€ì„œ', width: '100px' },
      { 
        field: 'salary', 
        title: 'ì—°ë´‰', 
        width: '120px',
        render: (value) => `â‚©${value.toLocaleString()}`
      },
      {
        field: 'actions',
        title: 'ì‘ì—…',
        width: '150px',
        sortable: false,
        render: (_, row, idx) => `
          <button class="btn btn--sm" onclick="openEditModal(${idx})" style="padding: 0.25rem 0.5rem; font-size: 0.75rem;">
            <i class="material-icons-outlined" style="font-size: 16px;">edit</i>
          </button>
          <button class="btn btn--sm btn--danger" onclick="deleteCrudRow(${idx})" style="padding: 0.25rem 0.5rem; font-size: 0.75rem; margin-left: 0.25rem;">
            <i class="material-icons-outlined" style="font-size: 16px;">delete</i>
          </button>
        `
      }
    ],
    selectable: true,
    paginate: true,
    pageSize: 5,
    toolbar: {
      buttons: [
        { 
          text: 'ìƒˆ í•­ëª©', 
          icon: 'add', 
          class: 'btn--success',
          onClick: () => {
            document.getElementById('add_form').style.display = 'block';
          }
        },
        { 
          text: 'ì„ íƒ ì‚­ì œ', 
          icon: 'delete', 
          class: 'btn--danger',
          onClick: () => {
            const selected = crudTable.getSelectedRows();
            if (selected.length === 0) {
              alert('ì„ íƒëœ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.');
              return;
            }
            if (confirm(`${selected.length}ê°œ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
              crudTable.deleteSelectedRows();
              crudData = crudTable.data;
            }
          }
        }
      ]
    }
  });
  instances.push(crudTable);

  // CRUD í•¨ìˆ˜ë“¤
  window.saveNewRow = function() {
    const name = document.getElementById('add_name').value;
    const email = document.getElementById('add_email').value;
    const department = document.getElementById('add_department').value;
    const salary = parseInt(document.getElementById('add_salary').value);

    if (!name || !email || !department || !salary) {
      alert('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }

    crudTable.addRow({
      id: nextId++,
      name,
      email,
      department,
      salary
    });
    crudData = crudTable.data;
    cancelAdd();
  };

  window.cancelAdd = function() {
    document.getElementById('add_form').style.display = 'none';
    document.getElementById('add_name').value = '';
    document.getElementById('add_email').value = '';
    document.getElementById('add_department').value = '';
    document.getElementById('add_salary').value = '';
  };

  window.openEditModal = function(idx) {
    const row = crudTable.filteredData[idx];
    document.getElementById('edit_index').value = idx;
    document.getElementById('edit_name').value = row.name;
    document.getElementById('edit_email').value = row.email;
    document.getElementById('edit_department').value = row.department;
    document.getElementById('edit_salary').value = row.salary;
    document.getElementById('edit_modal').style.display = 'flex';
  };

  window.closeEditModal = function() {
    document.getElementById('edit_modal').style.display = 'none';
  };

  window.saveEdit = function() {
    const idx = parseInt(document.getElementById('edit_index').value);
    crudTable.updateRow(idx, {
      name: document.getElementById('edit_name').value,
      email: document.getElementById('edit_email').value,
      department: document.getElementById('edit_department').value,
      salary: parseInt(document.getElementById('edit_salary').value)
    });
    crudData = crudTable.data;
    closeEditModal();
  };

  window.deleteCrudRow = function(idx) {
    if (confirm('ì´ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
      crudTable.deleteRow(idx);
      crudData = crudTable.data;
    }
  };

  // ============================================
  // ì´ˆê¸°í™”
  // ============================================
  
  loadData();
  
  // ì¸ìŠ¤í„´ìŠ¤ ë“±ë¡
  instances.forEach(inst => IMCAT.view.registerInstance(inst));
  
  console.log('DataTable ê³ ê¸‰ ì˜ˆì œ ë¡œë“œ ì™„ë£Œ');
</script>

<!-- Breadcrumb -->
<div class="page-title-box">
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="#" catui-href="views/home.html">Home</a></li>
      <li class="breadcrumb-item"><a href="#" catui-href="views/modules.html">Modules</a></li>
      <li class="breadcrumb-item active" aria-current="page">Scroll Components</li>
    </ol>
  </nav>
  <h1 class="page-title">Scroll Components</h1>
  <p class="page-description">Virtual Scroll, Scrollspy, Infinite Scroll, Back to Top 등 스크롤 관련 컴포넌트입니다.</p>
</div>

<!-- Virtual Scroll -->
<div class="row mb-4">
  <div class="col-12">
    <div class="card">
      <div class="card__header">
        <h2 class="card__title">Virtual Scroll</h2>
        <p class="card__description">대용량 리스트를 효율적으로 렌더링합니다. 10,000개 아이템도 부드럽게 스크롤됩니다.</p>
      </div>
      <div class="card__body">
        <div id="virtual_scroll_demo"></div>
        
        <div class="mt-3 d-flex gap-2 flex-wrap">
          <button class="btn btn--outline-primary btn--sm" onclick="virtualDemo.scrollToIndex(0)">맨 위로</button>
          <button class="btn btn--outline-primary btn--sm" onclick="virtualDemo.scrollToIndex(500)">500번</button>
          <button class="btn btn--outline-primary btn--sm" onclick="virtualDemo.scrollToIndex(999)">맨 아래</button>
        </div>
        
        <div class="mt-3 p-3 bg-secondary-subtle rounded">
          <strong>현재 보이는 범위:</strong> <span id="virtual_range">0 - 0</span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Scrollspy -->
<div class="row mb-4">
  <div class="col-12">
    <div class="card">
      <div class="card__header">
        <h2 class="card__title">Scrollspy</h2>
        <p class="card__description">스크롤 위치에 따라 네비게이션 항목을 자동으로 활성화합니다.</p>
      </div>
      <div class="card__body">
        <div class="row">
          <!-- Navigation -->
          <div class="col-md-3">
            <nav id="scrollspy_nav" class="scrollspy-nav">
              <ul class="scrollspy-nav__list">
                <li class="scrollspy-nav__item">
                  <a href="#section_intro" class="scrollspy-nav__link">소개</a>
                </li>
                <li class="scrollspy-nav__item">
                  <a href="#section_features" class="scrollspy-nav__link">기능</a>
                </li>
                <li class="scrollspy-nav__item">
                  <a href="#section_install" class="scrollspy-nav__link">설치</a>
                </li>
                <li class="scrollspy-nav__item">
                  <a href="#section_usage" class="scrollspy-nav__link">사용법</a>
                </li>
                <li class="scrollspy-nav__item">
                  <a href="#section_api" class="scrollspy-nav__link">API</a>
                </li>
              </ul>
            </nav>
          </div>
          
          <!-- Content -->
          <div class="col-md-9">
            <div id="scrollspy_container" style="height: 400px; overflow-y: auto; padding-right: 16px;">
              <section id="section_intro" style="padding: 24px 0; min-height: 200px;">
                <h3>소개</h3>
                <p>IMCAT UI는 현대적인 웹 애플리케이션을 위한 경량 UI 프레임워크입니다. 제로 빌드 철학을 기반으로 설계되어 복잡한 빌드 과정 없이 바로 사용할 수 있습니다.</p>
                <p>모든 컴포넌트는 접근성을 고려하여 설계되었으며, 키보드 네비게이션과 스크린 리더를 완벽하게 지원합니다.</p>
              </section>
              
              <section id="section_features" style="padding: 24px 0; min-height: 200px; border-top: 1px solid var(--border-color);">
                <h3>기능</h3>
                <ul>
                  <li>제로 빌드 - 빌드 없이 바로 사용</li>
                  <li>경량화 - 핵심 기능만 포함</li>
                  <li>모듈화 - 필요한 모듈만 로드</li>
                  <li>다크 모드 - 자동 테마 전환</li>
                  <li>접근성 - WCAG 2.1 AA 준수</li>
                  <li>반응형 - 모바일 우선 설계</li>
                </ul>
              </section>
              
              <section id="section_install" style="padding: 24px 0; min-height: 200px; border-top: 1px solid var(--border-color);">
                <h3>설치</h3>
                <p>CDN을 통해 간단하게 설치할 수 있습니다:</p>
                <pre style="background: var(--bg-secondary); padding: 16px; border-radius: 8px; overflow-x: auto;"><code>&lt;link rel="stylesheet" href="imcat-ui.css"&gt;
&lt;script src="imcat-ui.js"&gt;&lt;/script&gt;</code></pre>
              </section>
              
              <section id="section_usage" style="padding: 24px 0; min-height: 200px; border-top: 1px solid var(--border-color);">
                <h3>사용법</h3>
                <p>모듈을 로드하고 인스턴스를 생성하면 됩니다:</p>
                <pre style="background: var(--bg-secondary); padding: 16px; border-radius: 8px; overflow-x: auto;"><code>const Module = await IMCAT.use('moduleName');
const instance = new Module('#container', options);
IMCAT.view.registerInstance(instance);</code></pre>
              </section>
              
              <section id="section_api" style="padding: 24px 0; min-height: 200px; border-top: 1px solid var(--border-color);">
                <h3>API</h3>
                <p>각 모듈은 일관된 API를 제공합니다:</p>
                <ul>
                  <li><code>static defaults()</code> - 기본 옵션 반환</li>
                  <li><code>constructor(selector, options)</code> - 인스턴스 생성</li>
                  <li><code>destroy()</code> - 인스턴스 정리</li>
                </ul>
                <p>자세한 API 문서는 각 모듈의 README를 참조하세요.</p>
              </section>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Infinite Scroll -->
<div class="row mb-4">
  <div class="col-12">
    <div class="card">
      <div class="card__header">
        <h2 class="card__title">Infinite Scroll</h2>
        <p class="card__description">스크롤 시 자동으로 더 많은 콘텐츠를 로드합니다.</p>
      </div>
      <div class="card__body">
        <div id="infinite_scroll_demo" style="height: 400px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: 8px;"></div>
        
        <div class="mt-3 d-flex gap-2">
          <button class="btn btn--outline-secondary btn--sm" onclick="infiniteDemo.reset(); loadedCount = 0;">초기화</button>
          <span class="ms-auto text-secondary">로드된 항목: <span id="loaded_count">0</span>개</span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Back to Top -->
<div class="row mb-4">
  <div class="col-12">
    <div class="card">
      <div class="card__header">
        <h2 class="card__title">Back to Top</h2>
        <p class="card__description">스크롤 시 나타나는 맨 위로 버튼입니다.</p>
      </div>
      <div class="card__body">
        <p>이 페이지를 스크롤하면 오른쪽 하단에 "맨 위로" 버튼이 나타납니다.</p>
        
        <div class="alert alert--info">
          <i class="material-icons-outlined">info</i>
          <span>300px 이상 스크롤하면 버튼이 나타납니다. 페이지를 스크롤해보세요!</span>
        </div>
        
        <div class="d-flex gap-2 flex-wrap">
          <button class="btn btn--primary" onclick="ScrollModule.SmoothScroll.toTop()">맨 위로</button>
          <button class="btn btn--outline-primary" onclick="ScrollModule.SmoothScroll.toBottom()">맨 아래로</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Smooth Scroll -->
<div class="row mb-4">
  <div class="col-12">
    <div class="card">
      <div class="card__header">
        <h2 class="card__title">Smooth Scroll</h2>
        <p class="card__description">부드러운 스크롤 유틸리티입니다.</p>
      </div>
      <div class="card__body">
        <div class="row g-3">
          <div class="col-md-4">
            <div class="p-4 bg-secondary-subtle rounded text-center" id="scroll_target_1">
              <h4>Target 1</h4>
              <p class="text-secondary mb-0">첫 번째 타겟</p>
            </div>
          </div>
          <div class="col-md-4">
            <div class="p-4 bg-primary-subtle rounded text-center" id="scroll_target_2">
              <h4>Target 2</h4>
              <p class="text-secondary mb-0">두 번째 타겟</p>
            </div>
          </div>
          <div class="col-md-4">
            <div class="p-4 bg-success-subtle rounded text-center" id="scroll_target_3">
              <h4>Target 3</h4>
              <p class="text-secondary mb-0">세 번째 타겟</p>
            </div>
          </div>
        </div>
        
        <div class="mt-4 d-flex gap-2 flex-wrap">
          <button class="btn btn--outline-secondary btn--sm" onclick="ScrollModule.SmoothScroll.to('#scroll_target_1', { offset: 100 })">Target 1로 이동</button>
          <button class="btn btn--outline-primary btn--sm" onclick="ScrollModule.SmoothScroll.to('#scroll_target_2', { offset: 100 })">Target 2로 이동</button>
          <button class="btn btn--outline-success btn--sm" onclick="ScrollModule.SmoothScroll.to('#scroll_target_3', { offset: 100 })">Target 3로 이동</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Code Example -->
<div class="row mb-4">
  <div class="col-12">
    <div class="card">
      <div class="card__header">
        <h2 class="card__title">사용법</h2>
      </div>
      <div class="card__body">
        <pre><code class="language-javascript">// 모듈 로드
const Scroll = await IMCAT.use('scroll');

// Virtual Scroll - 대용량 리스트
const virtualScroll = new Scroll.VirtualScroll('#container', {
  items: Array.from({ length: 10000 }, (_, i) => ({ id: i, name: `Item ${i}` })),
  itemHeight: 50,
  containerHeight: 400,
  renderItem: (item, index) => `&lt;span&gt;${item.name}&lt;/span&gt;`,
  onScroll: (scrollTop, range) => {
    console.log('Visible:', range.start, '-', range.end);
  }
});
virtualScroll.scrollToIndex(500); // 특정 위치로 이동

// Scrollspy - 스크롤 네비게이션
const scrollspy = new Scroll.Scrollspy('#content', {
  target: '#nav',
  sections: ['#section1', '#section2', '#section3'],
  offset: 100,
  onChange: (activeId, prevId) => {
    console.log('Active section:', activeId);
  }
});
scrollspy.scrollTo('section2'); // 특정 섹션으로 이동

// Infinite Scroll - 무한 스크롤
const infiniteScroll = new Scroll.InfiniteScroll('#list', {
  threshold: 200,
  loadMore: async () => {
    const response = await fetch('/api/items?page=' + page);
    return response.json();
  },
  renderItem: (item) => `&lt;div&gt;${item.title}&lt;/div&gt;`,
  onLoad: (items, total) => {
    console.log('Loaded:', total, 'items');
  }
});

// Back to Top - 맨 위로 버튼
const backToTop = new Scroll.BackToTop({
  threshold: 300,
  position: 'bottom-right',
  smooth: true
});

// Smooth Scroll - 유틸리티
Scroll.SmoothScroll.to('#target', { offset: 100, duration: 500 });
Scroll.SmoothScroll.toTop();
Scroll.SmoothScroll.toBottom();

// 메모리 관리
IMCAT.view.registerInstance(virtualScroll);
IMCAT.view.registerInstance(scrollspy);
IMCAT.view.registerInstance(infiniteScroll);
IMCAT.view.registerInstance(backToTop);</code></pre>
      </div>
    </div>
  </div>
</div>

<script type="module">
// 모듈 로드
window.ScrollModule = await IMCAT.use('scroll');
const { VirtualScroll, Scrollspy, InfiniteScroll, BackToTop, SmoothScroll } = ScrollModule;

// Virtual Scroll 데모
const virtualItems = Array.from({ length: 1000 }, (_, i) => ({
  id: i,
  name: `사용자 ${i + 1}`,
  email: `user${i + 1}@example.com`,
  status: i % 3 === 0 ? 'active' : i % 3 === 1 ? 'pending' : 'inactive'
}));

window.virtualDemo = new VirtualScroll('#virtual_scroll_demo', {
  items: virtualItems,
  itemHeight: 56,
  containerHeight: 350,
  renderItem: (item, index) => {
    const statusColors = {
      active: '#10b981',
      pending: '#f59e0b',
      inactive: '#6b7280'
    };
    const statusLabels = {
      active: '활성',
      pending: '대기',
      inactive: '비활성'
    };
    
    return `
      <div style="display: flex; align-items: center; gap: 12px; width: 100%;">
        <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 14px;">
          ${item.name.charAt(0)}
        </div>
        <div style="flex: 1; min-width: 0;">
          <div style="font-weight: 500; color: var(--text-primary);">${item.name}</div>
          <div style="font-size: 13px; color: var(--text-secondary); text-overflow: ellipsis; overflow: hidden; white-space: nowrap;">${item.email}</div>
        </div>
        <span style="padding: 4px 10px; border-radius: 12px; font-size: 12px; background: ${statusColors[item.status]}20; color: ${statusColors[item.status]};">
          ${statusLabels[item.status]}
        </span>
        <span style="font-size: 12px; color: var(--text-secondary);">#${item.id + 1}</span>
      </div>
    `;
  },
  onScroll: (scrollTop, range) => {
    document.getElementById('virtual_range').textContent = `${range.start} - ${range.end}`;
  }
});
IMCAT.view.registerInstance(virtualDemo);

// Scrollspy 데모
const scrollspy = new Scrollspy('#scrollspy_container', {
  target: '#scrollspy_nav',
  offset: 50,
  smoothScroll: true,
  onChange: (activeId) => {
    console.log('Active section:', activeId);
  }
});
IMCAT.view.registerInstance(scrollspy);

// Infinite Scroll 데모
window.loadedCount = 0;
let infinitePage = 0;

window.infiniteDemo = new InfiniteScroll('#infinite_scroll_demo', {
  threshold: 100,
  loadMore: async () => {
    // 시뮬레이션: 200ms 지연
    await new Promise(resolve => setTimeout(resolve, 200));
    
    infinitePage++;
    if (infinitePage > 5) return []; // 5페이지 후 종료
    
    return Array.from({ length: 10 }, (_, i) => ({
      id: (infinitePage - 1) * 10 + i,
      title: `아이템 ${(infinitePage - 1) * 10 + i + 1}`,
      description: `이것은 ${infinitePage}페이지의 ${i + 1}번째 아이템입니다.`
    }));
  },
  renderItem: (item) => `
    <div style="padding: 16px; border-bottom: 1px solid var(--border-color); display: flex; align-items: center; gap: 12px;">
      <div style="width: 48px; height: 48px; border-radius: 8px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); display: flex; align-items: center; justify-content: center;">
        <i class="material-icons-outlined" style="color: white;">article</i>
      </div>
      <div style="flex: 1;">
        <div style="font-weight: 500;">${item.title}</div>
        <div style="font-size: 13px; color: var(--text-secondary);">${item.description}</div>
      </div>
    </div>
  `,
  onLoad: (items, total) => {
    loadedCount = total;
    document.getElementById('loaded_count').textContent = total;
  }
});
IMCAT.view.registerInstance(infiniteDemo);

// Back to Top 버튼
const backToTop = new BackToTop({
  threshold: 300,
  position: 'bottom-right',
  icon: 'keyboard_arrow_up',
  smooth: true
});
IMCAT.view.registerInstance(backToTop);
</script>

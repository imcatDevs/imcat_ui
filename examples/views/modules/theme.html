<!-- Breadcrumb -->
<div class="page-title-box">
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="#home">Home</a></li>
      <li class="breadcrumb-item"><a href="#modules">Modules</a></li>
      <li class="breadcrumb-item active">Theme</li>
    </ol>
  </nav>
  <h1 class="page-title">Theme</h1>
  <p class="page-description">테마 관리 모듈 - View Transitions API를 활용한 고급 테마 전환 효과</p>
</div>

<!-- 기본 테마 스위처 -->
<div class="row">
  <div class="col-xl-6">
    <div class="card">
      <div class="card__header">
        <h2 class="card__title">기본 테마 스위처</h2>
        <p class="card__description">라이트/다크/시스템 테마 전환</p>
      </div>
      <div class="card__body">
        <div class="d-flex gap-3 flex-wrap mb-4">
          <button class="btn btn-outline-primary" onclick="demo_setTheme('light')">
            <i class="material-icons-outlined me-1">light_mode</i>
            라이트
          </button>
          <button class="btn btn-outline-primary" onclick="demo_setTheme('dark')">
            <i class="material-icons-outlined me-1">dark_mode</i>
            다크
          </button>
          <button class="btn btn-outline-primary" onclick="demo_setTheme('system')">
            <i class="material-icons-outlined me-1">settings_brightness</i>
            시스템
          </button>
        </div>
        <div id="theme_status" class="alert alert-info mb-0">
          현재 테마: <strong id="current_theme">-</strong> (실제 적용: <strong id="resolved_theme">-</strong>)
        </div>
      </div>
    </div>
  </div>

  <div class="col-xl-6">
    <div class="card">
      <div class="card__header">
        <h2 class="card__title">토글 버튼</h2>
        <p class="card__description">간단한 토글 스위치</p>
      </div>
      <div class="card__body">
        <div class="d-flex align-items-center gap-4">
          <button id="toggle_basic" class="btn btn-lg" onclick="demo_toggle()">
            <i class="material-icons-outlined me-2" id="toggle_icon">dark_mode</i>
            <span id="toggle_text">다크 모드</span>
          </button>
          
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="theme_switch" onchange="demo_switchChange(this)">
            <label class="form-check-label" for="theme_switch">다크 모드</label>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- 전환 효과 -->
<div class="row">
  <div class="col-12">
    <div class="card">
      <div class="card__header">
        <h2 class="card__title">전환 효과 (View Transitions API)</h2>
        <p class="card__description">다양한 전환 애니메이션 효과 - Chrome 111+ 에서 최적의 효과를 경험하세요</p>
      </div>
      <div class="card__body">
        <div class="mb-4">
          <h6 class="mb-3">전환 타입 선택</h6>
          <div class="d-flex gap-2 flex-wrap">
            <button class="btn btn-outline-secondary btn-sm" onclick="demo_setTransition('none')">없음</button>
            <button class="btn btn-outline-secondary btn-sm" onclick="demo_setTransition('fade')">페이드</button>
            <button class="btn btn-outline-secondary btn-sm" onclick="demo_setTransition('slide')">슬라이드</button>
            <button class="btn btn-outline-secondary btn-sm" onclick="demo_setTransition('circle')">원형</button>
            <button class="btn btn-outline-secondary btn-sm" onclick="demo_setTransition('circle-center')">원형 (중앙)</button>
            <button class="btn btn-outline-secondary btn-sm" onclick="demo_setTransition('circle-top-left')">원형 (좌상단)</button>
            <button class="btn btn-outline-secondary btn-sm" onclick="demo_setTransition('circle-top-right')">원형 (우상단)</button>
            <button class="btn btn-outline-secondary btn-sm" onclick="demo_setTransition('circle-bottom-left')">원형 (좌하단)</button>
          </div>
          <p class="text-muted small mt-2">현재 전환 효과: <strong id="current_transition">none</strong></p>
        </div>
        
        <div class="mb-4">
          <h6 class="mb-3">전환 시간 조절</h6>
          <div class="d-flex align-items-center gap-3">
            <input type="range" class="form-range" style="max-width: 300px;" min="200" max="2000" step="100" value="800" id="duration_slider" oninput="demo_setDuration(this.value)">
            <span id="duration_value">800ms</span>
          </div>
        </div>
        
        <button class="btn btn-primary btn-lg" onclick="demo_toggle()">
          <i class="material-icons-outlined me-2">swap_horiz</i>
          전환 효과 테스트
        </button>
      </div>
    </div>
  </div>
</div>

<!-- 클릭 위치 기반 전환 -->
<div class="row">
  <div class="col-12">
    <div class="card">
      <div class="card__header">
        <h2 class="card__title">클릭 위치 기반 원형 전환</h2>
        <p class="card__description">클릭한 위치에서 원형으로 확대되는 효과</p>
      </div>
      <div class="card__body">
        <div id="click_area" 
             style="height: 200px; background: var(--bg-secondary); border-radius: 12px; display: flex; align-items: center; justify-content: center; cursor: pointer; border: 2px dashed var(--border-color); transition: all 0.3s;"
             onmouseover="this.style.borderColor='var(--primary-color)'"
             onmouseout="this.style.borderColor='var(--border-color)'"
             onclick="demo_clickTransition(event)">
          <div class="text-center">
            <i class="material-icons-outlined" style="font-size: 48px; color: var(--text-secondary);">touch_app</i>
            <p class="text-muted mt-2 mb-0">이 영역을 클릭하면 클릭한 위치에서 테마가 전환됩니다</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- 테마 상태 리스너 -->
<div class="row">
  <div class="col-xl-6">
    <div class="card">
      <div class="card__header">
        <h2 class="card__title">테마 변경 리스너</h2>
        <p class="card__description">onChange() 메서드로 테마 변경 감지</p>
      </div>
      <div class="card__body">
        <div id="theme_log" style="height: 200px; overflow-y: auto; background: var(--bg-secondary); border-radius: 8px; padding: 1rem; font-family: monospace; font-size: 0.875rem;">
          <div style="color: var(--text-secondary);">테마 변경 로그가 여기에 표시됩니다...</div>
        </div>
        <button class="btn btn-outline-secondary btn-sm mt-3" onclick="demo_clearLog()">
          <i class="material-icons-outlined me-1">delete</i>
          로그 지우기
        </button>
      </div>
    </div>
  </div>

  <div class="col-xl-6">
    <div class="card">
      <div class="card__header">
        <h2 class="card__title">헬퍼 메서드</h2>
        <p class="card__description">유용한 상태 확인 메서드</p>
      </div>
      <div class="card__body">
        <div class="d-grid gap-3">
          <div class="d-flex justify-content-between align-items-center p-3" style="background: var(--bg-secondary); border-radius: 8px;">
            <code>theme.isDark()</code>
            <span id="is_dark" class="badge"></span>
          </div>
          <div class="d-flex justify-content-between align-items-center p-3" style="background: var(--bg-secondary); border-radius: 8px;">
            <code>theme.isLight()</code>
            <span id="is_light" class="badge"></span>
          </div>
          <div class="d-flex justify-content-between align-items-center p-3" style="background: var(--bg-secondary); border-radius: 8px;">
            <code>theme.getSystemTheme()</code>
            <span id="system_theme" class="badge bg-secondary"></span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- API 사용법 -->
<div class="row">
  <div class="col-12">
    <div class="card">
      <div class="card__header">
        <h2 class="card__title">API 사용법</h2>
      </div>
      <div class="card__body">
        <h5 class="mb-3">초기화</h5>
        <pre class="bg-dark text-light p-3 rounded"><code>const ThemeModule = await IMCAT.use('theme');

// 방법 1: 클래스 직접 사용
const theme = new ThemeModule.Theme({
  defaultTheme: 'system',       // 'light', 'dark', 'system'
  storageKey: 'imcat-theme',    // localStorage 키
  transition: 'circle',         // 'none', 'fade', 'slide', 'circle', 'circle-*'
  transitionDuration: 800,      // 전환 시간 (ms)
  themes: {},                   // 커스텀 테마
  onChange: (resolved, setting) => { }
});

// 방법 2: 싱글톤 팩토리 사용
const theme = ThemeModule.createTheme({ transition: 'fade' });
const sameTheme = ThemeModule.getTheme(); // 같은 인스턴스 반환

// 방법 3: 싱글톤 재초기화
const newTheme = ThemeModule.initTheme({ transition: 'slide' });</code></pre>

        <h5 class="mb-3 mt-4">기본 사용</h5>
        <pre class="bg-dark text-light p-3 rounded"><code>// 테마 설정
theme.set('dark');                    // 다크 모드
theme.set('light', true, false);      // 라이트 모드 (저장O, 애니메이션X)
theme.set('system', false);           // 시스템 설정 (저장X)

// 테마 토글
theme.toggle();                       // 애니메이션과 함께 토글
theme.toggle(false);                  // 애니메이션 없이 토글

// 테마 조회
theme.get();                          // 설정값 ('light', 'dark', 'system')
theme.getResolved();                  // 실제 적용된 테마 ('light' 또는 'dark')
theme.getSystemTheme();               // 시스템 테마

// 상태 확인
theme.isDark();                       // boolean
theme.isLight();                      // boolean</code></pre>

        <h5 class="mb-3 mt-4">전환 효과</h5>
        <pre class="bg-dark text-light p-3 rounded"><code>// 전환 효과 변경
theme.setTransition('fade');          // 페이드
theme.setTransition('slide');         // 슬라이드
theme.setTransition('circle');        // 원형 (우하단에서)
theme.setTransition('circle-center'); // 원형 (중앙에서)
theme.setTransition('circle-top-left'); // 원형 (좌상단에서)
theme.setTransition('none', 500);     // 효과 없음, 시간 변경

// 클릭 위치 기반 원형 전환
theme.setWithCircleAt('dark', 100, 200);  // (테마, x좌표, y좌표)
theme.setWithCircleAt('light', x, y, 1000); // 시간 지정

// 이벤트 기반 전환 (버튼 클릭 시)
button.addEventListener('click', (e) => {
  theme.toggleWithEvent(e);           // 클릭 위치에서 원형 전환
  theme.toggleWithEvent(e, 'dark');   // 특정 테마로 전환
});</code></pre>

        <h5 class="mb-3 mt-4">리스너 등록</h5>
        <pre class="bg-dark text-light p-3 rounded"><code>// 테마 변경 리스너
const unsubscribe = theme.onChange((resolvedTheme, settingTheme) => {
  console.log('테마 변경:', resolvedTheme, settingTheme);
});

// 구독 해제
unsubscribe();

// DOM 이벤트 리스너
document.addEventListener('imcat:themechange', (e) => {
  console.log('변경됨:', e.detail.theme, e.detail.resolvedTheme);
});

document.addEventListener('imcat:systemthemechange', (e) => {
  console.log('시스템 테마 변경:', e.detail.theme);
});</code></pre>

        <h5 class="mb-3 mt-4">커스텀 테마</h5>
        <pre class="bg-dark text-light p-3 rounded"><code>// 커스텀 테마 등록
theme.register('ocean', {
  '--text-primary': '#0c4a6e',
  '--text-secondary': '#0369a1',
  '--bg-primary': '#e0f2fe',
  '--bg-secondary': '#bae6fd',
  '--primary-color': '#0284c7'
});

// 커스텀 테마 적용
theme.set('ocean');</code></pre>

        <h5 class="mb-3 mt-4">전환 효과 타입 상수</h5>
        <pre class="bg-dark text-light p-3 rounded"><code>const { Theme } = await IMCAT.use('theme');

Theme.TRANSITIONS.NONE;           // 'none'
Theme.TRANSITIONS.FADE;           // 'fade'
Theme.TRANSITIONS.SLIDE;          // 'slide'
Theme.TRANSITIONS.CIRCLE;         // 'circle'
Theme.TRANSITIONS.CIRCLE_TOP_LEFT;     // 'circle-top-left'
Theme.TRANSITIONS.CIRCLE_TOP_RIGHT;    // 'circle-top-right'
Theme.TRANSITIONS.CIRCLE_BOTTOM_LEFT;  // 'circle-bottom-left'
Theme.TRANSITIONS.CIRCLE_BOTTOM_RIGHT; // 'circle-bottom-right'
Theme.TRANSITIONS.CIRCLE_CENTER;       // 'circle-center'</code></pre>
      </div>
    </div>
  </div>
</div>

<script type="module">
  const ThemeModule = await IMCAT.use('theme');
  const { Theme } = ThemeModule;
  
  // 기존 인스턴스 정리 후 새로 생성
  if (window.themeDemo && window.themeDemo.destroy) {
    window.themeDemo.destroy();
  }
  
  window.themeDemo = new Theme({
    transition: 'none',
    transitionDuration: 800
  });
  
  IMCAT.view.registerInstance(window.themeDemo);
  
  // UI 업데이트 함수
  function updateUI() {
    const theme = window.themeDemo;
    const current = theme.get();
    const resolved = theme.getResolved();
    
    document.getElementById('current_theme').textContent = current;
    document.getElementById('resolved_theme').textContent = resolved;
    
    // 토글 버튼 상태
    const toggleBtn = document.getElementById('toggle_basic');
    const toggleIcon = document.getElementById('toggle_icon');
    const toggleText = document.getElementById('toggle_text');
    
    if (resolved === 'dark') {
      toggleBtn.className = 'btn btn-lg btn-dark';
      toggleIcon.textContent = 'light_mode';
      toggleText.textContent = '라이트 모드';
      document.getElementById('theme_switch').checked = true;
    } else {
      toggleBtn.className = 'btn btn-lg btn-light';
      toggleIcon.textContent = 'dark_mode';
      toggleText.textContent = '다크 모드';
      document.getElementById('theme_switch').checked = false;
    }
    
    // 헬퍼 메서드 상태
    const isDark = theme.isDark();
    const isLight = theme.isLight();
    
    document.getElementById('is_dark').textContent = isDark ? 'true' : 'false';
    document.getElementById('is_dark').className = `badge ${isDark ? 'bg-success' : 'bg-danger'}`;
    
    document.getElementById('is_light').textContent = isLight ? 'true' : 'false';
    document.getElementById('is_light').className = `badge ${isLight ? 'bg-success' : 'bg-danger'}`;
    
    document.getElementById('system_theme').textContent = theme.getSystemTheme();
  }
  
  // 리스너 등록
  window.themeDemo.onChange((resolved, setting) => {
    updateUI();
    
    const log = document.getElementById('theme_log');
    const time = new Date().toLocaleTimeString();
    const entry = document.createElement('div');
    entry.style.color = 'var(--text-primary)';
    entry.innerHTML = `<span style="color: var(--text-secondary);">[${time}]</span> 테마 변경: <strong>${resolved}</strong> (설정: ${setting})`;
    log.appendChild(entry);
    log.scrollTop = log.scrollHeight;
  });
  
  // 초기 UI 업데이트
  updateUI();
  
  // 전역 함수들
  window.demo_setTheme = function(theme) {
    window.themeDemo.set(theme);
  };
  
  window.demo_toggle = function() {
    window.themeDemo.toggle();
  };
  
  window.demo_switchChange = function(checkbox) {
    window.themeDemo.set(checkbox.checked ? 'dark' : 'light');
  };
  
  window.demo_setTransition = function(type) {
    window.themeDemo.setTransition(type);
    document.getElementById('current_transition').textContent = type;
  };
  
  window.demo_setDuration = function(duration) {
    window.themeDemo.options.transitionDuration = parseInt(duration);
    document.getElementById('duration_value').textContent = duration + 'ms';
  };
  
  window.demo_clickTransition = function(event) {
    window.themeDemo.toggleWithEvent(event);
  };
  
  window.demo_clearLog = function() {
    const log = document.getElementById('theme_log');
    log.innerHTML = '<div style="color: var(--text-secondary);">테마 변경 로그가 여기에 표시됩니다...</div>';
  };
</script>
